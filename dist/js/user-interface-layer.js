(function(){function a(){switch(mwdspace.currentStepName){case"giftAmount":c("donorInfo");break;case"donorInfo":c("payment");}}function b(){switch(mwdspace.currentStepName){case"donorInfo":c("giftAmount");break;case"payment":c("donorInfo");}}function c(a){mwdspace.currentStepName="",a=window.mwdspace.sharedUtils.ensureString(a),a||(a=window.mwdspace.sharedUtils.getSessionValue("savedStepName"),!a&&(a="giftAmount")),p("div.giftFormContainer div.loadingDisplay").hide();for(var b,c=0;c<q.length;c++)b=q[c].getAttribute("data-step-name"),b==a?(0==c?r.hide():(p("div.giftFormHeaderContainer").show(),r.fadeIn(888)),p(q[c]).fadeIn(666,function(){o(p("div.giftFormContainer"))}),mwdspace.currentStepName=b,window.mwdspace.sharedUtils.setSessionValue("savedStepName",b)):p(q[c]).hide()}function d(a){var b=null;try{a.code&&(b=document.createElement("option"),b.setAttribute("value",a.code),b.innerText=a.code+" "+(a.name||""))}catch(b){console.error("Unable to build the option element for currency:",a)}return b}function e(a){var b=null;try{a.code&&(b=document.createElement("option"),b.setAttribute("value",a.code),b.innerText=a.description||"")}catch(b){console.error("Unable to build the option element for method:",a)}return b}function f(a){var b=null;try{if(a.code){b=document.createElement("div"),p(b).addClass("giftOption fixed");var c=document.createElement("label");p(c).addClass("giftOption"),c.innerText=a.name||"Unknown",b.appendChild(c);var d=document.createElement("input");d.setAttribute("type","radio"),d.setAttribute("name","giftFrequency"),d.setAttribute("value",a.code),c.appendChild(d)}}catch(b){console.error("Error building the button for frequency:",a,b)}return b}function g(){if("undefined"==typeof a)var a={};"object"!=typeof a&&(a={},console.warn("prepareRegionInput(): ignoring invalid option object",a));try{for(var b,c=p("div.giftFormContainer select[name=\"donorCountry\"]").val(),d=0;d<window.mwdspace.validCountryList.length;d++)if(b=window.mwdspace.validCountryList[d],(c==b.code||c==b.name)&&b.regions&&j(b.regions))return!0}catch(a){console.error("Unable to prepare the region input method",a)}h()}function h(){t.val("").show(),s.hide()}function j(a){if(t.hide(),s.show(),"undefined"==typeof a)return console.warn("buildRegionSelect(): no regions object",a),!1;if("object"!=typeof a||1>a.length)return console.warn("buildRegionSelect(): invalid regions object",a),!1;try{if(1!==s.length)return console.error("Unable to identify the region select dropdown"),!1;var b,c,d=0;s.empty(),b=k("State/Region..."),s.append(b);for(var e=0;e<a.length;e++)c=a[e],b=k(c.name),b?(s.append(b),d++):console.warn("Unable to add region:",c);if(0<d)return!0}catch(a){console.error("Unable to build the region select dropdown",a)}return!1}function k(a){try{if("string"==typeof a&&a.trim()){var b=null;return b=document.createElement("option"),b.innerText=a,b}}catch(a){console.error("Unable to build the option element for region:",region)}return null}function l(a){var b=null;try{a.code&&(b=document.createElement("option"),b.setAttribute("value",a.code),b.innerText=a.name)}catch(b){console.error("Unable to build the option element for country:",a)}return b}function i(a,b){var c=null;try{if("number"!=typeof a&&"string"!=typeof a&&!a)console.error("Invalid month given:",a);else{if("undefined"==typeof b)var b=a;try{a=window.mwdspace.sharedUtils.ensureString(a),a=a.padStart(2,"0")}catch(a){}c=document.createElement("option"),c.setAttribute("value",b),c.innerText=a}}catch(b){console.error("Unable to build the option element for month:",a)}return c}function m(a,b){var c=null;try{if("number"!=typeof a&&"string"!=typeof a&&!a)console.error("Invalid year given:",a);else{if("undefined"==typeof b)var b=a;c=document.createElement("option"),c.setAttribute("value",b),c.innerText=a}}catch(b){console.error("Unable to build the option element for year:",a)}return c}function n(a){for(var b=0;b<a.length;b++);}function o(a){a=p(a);var b=p(window).scrollTop(),c=p(window).height(),d=b,e=(a.outerHeight()-a.innerHeight())/2;e=0>=e?4:e;var f=a.offset().top+e,g=f+a.innerHeight();return a.innerHeight()>c?void p("html,body").animate({scrollTop:f,easing:"ease"},999):d>f?void p("html,body").animate({scrollTop:f,easing:"ease"},999):void(d+c<g&&p("html,body").animate({scrollTop:g-c+e,easing:"ease"},999))}console.log("user-interface-layer.js v18.7.2"),window.mwdspace=window.mwdspace||{},"function"!=typeof window.mwdspace.jquery&&(console.error("jQuery (window.mwdspace.jquery) not found"),exit());var p=window.mwdspace.jquery;console.log("Using jQuery version",p.fn.jquery);window.mwdspace.defaultGiftList=[25,50,75,100];var q=p("div.giftFormContainer section.step"),r=p("div.giftFormContainer button.goPreviousStep"),s=p("div.giftFormContainer select[name=\"donorRegion\"]"),t=p("div.giftFormContainer input[name=\"donorRegion\"]");"object"==typeof Spreedly?(Spreedly.on("ready",function(){console.log("\n\nSPREEDLY READY",Spreedly),Spreedly.setPlaceholder("number","Card"),Spreedly.setFieldType("number","text"),Spreedly.setNumberFormat("prettyFormat"),Spreedly.setLabel("number","Payment card number"),Spreedly.setPlaceholder("cvv","cvv"),Spreedly.setLabel("cvv","Payment card 3-digit verification code"),Spreedly.setValue("number","4111111111111111"),Spreedly.setValue("cvv","123")}),Spreedly.on("paymentMethod",function(a){console.log("\n\nSPREEDLY PAYMENT TOKENIZED",a)}),Spreedly.on("errors",function(a){console.log("\n\nSPREEDLY REPORTS ERRORS:");for(var b,c=0;c<a.length;c++)b=a[c],console.log(b)})):console.warn("Skipping Spreedly setup"),function(a){if("undefined"==typeof a)var a={};"object"!=typeof a&&(a={},console.warn("buildCurrencySelect(): ignoring invalid option object",a));var b="string"==typeof a.default?a.default:"USD";try{if(!window.mwdspace.validCurrencyList)throw new Error("List of valid currencies not found");var c=p("div.giftFormContainer select[name=\"giftCurrency\"]");if(1!==c.length)throw new Error("Unable to identify the currency select dropdown");for(var e,f,g,h=0;h<window.mwdspace.validCurrencyList.length;h++)g=!0,f=window.mwdspace.validCurrencyList[h],a.filterList&&(g=n(a.filterList,f.code)),g&&(e=d(f),e?c.append(e):console.warn("Unable to add currency:",f));c.val(b).trigger("change")}catch(a){console.error("Unable to build the currency select dropdown",a)}}(),function(){try{if(!window.mwdspace.validPayMethodList)throw new Error("List of valid payment methods not found");var a=p("div.giftFormContainer select[name=\"payMethod\"]");if(1!==a.length)throw new Error("Unable to identify the payment method select dropdown");for(var b,c=0;c<window.mwdspace.validPayMethodList.length;c++)b=e(window.mwdspace.validPayMethodList[c]),b?a.append(b):console.warn("Unable to add payment method:",window.mwdspace.validPayMethodList[c])}catch(a){console.error("Unable to build the payment method select dropdown",a)}}(),function(a){try{if(!a||1>a.length)throw new Error("Invalid list of frequencies given");var b=p("div.giftFormContainer div.giftFrequencyContainer");if(1!==b.length)throw new Error("Unable to identify the frequency select dropdown");b.find("div.giftOption").remove();for(var c,d=0;d<a.length;d++)c=f(a[d]),c?b.append(c):console.warn("Unable to add frequency:",a[d])}catch(a){console.error("Unable to build the frequency buttons",a)}}(window.mwdspace.validPayMethodList[0].frequencies),function(a){if("undefined"==typeof a)var a={};"object"!=typeof a&&(a={},console.warn("buildCountrySelect(): ignoring invalid option object",a));var b="string"==typeof a.default?a.default:"US";try{if(!window.mwdspace.validCountryList)throw new Error("List of valid countries not found");var c=p("div.giftFormContainer select[name=\"donorCountry\"]");if(c.on("change",g),1!==c.length)throw new Error("Unable to identify the country select dropdown");for(var d,e,f,h=0;h<window.mwdspace.validCountryList.length;h++)f=!0,e=window.mwdspace.validCountryList[h],a.filterList&&(f=n(a.filterList,e.code)),f&&(d=l(e),d?c.append(d):console.warn("Unable to add country:",e));c.val(b).trigger("change")}catch(a){console.error("Unable to build the country select dropdown",a)}}(),function(){try{var a=p("div.giftFormContainer select[name=\"payCardExpireMonth\"]");if(1!==a.length)throw new Error("Unable to identify the card expire month select dropdown");var b=i("Month","");a.append(b);for(var c=1;12>=c;c++)b=i(c),b?a.append(b):console.warn("Unable to add card expire month:",c)}catch(a){console.error("Unable to build the card expire month select dropdown",a)}}(),function(){try{var a=new Date;a.setDate(a.getDate()-7);var b=a.getFullYear(),c=p("div.giftFormContainer select[name=\"payCardExpireYear\"]");if(1!==c.length)throw new Error("Unable to identify the card expire year select dropdown");var d=m("Year","");c.append(d);for(var e=b;e<b+15;e++)d=m(e),d?c.append(d):console.warn("Unable to add card expire year:",e)}catch(a){console.error("Unable to build the card expire year select dropdown",a)}}(),p("select[name=\"donorMatchCompany\"]").select2({minimumInputLength:3,delay:250,placeholder:"Enter your company name",ajax:{url:"https://platform.funraise.io/api/v1/ddcompanies",data:function(a){var b={q:a.term};return b},processResults:function(a){var b={results:[]};if("object"==typeof a&&a.length)for(var c=0;c<a.length;c++)a[c].name&&b.results.push({id:c,text:a[c].name});return b}}}),setInterval(function(){p(".select2-container").css("width","100%")},999),c(),"object"==typeof Spreedly&&Spreedly.init("ODBm2idmYFT3pBge5qxRBjQaWH9",{numberEl:"cardNumberTarget",cvvEl:"cardCvvTarget"}),p("input[type=radio]").change(function(){p(this).closest("section").find("input[type=radio]").closest("label").removeClass("selected"),p(this).closest("label").addClass("selected"),p("div.giftFormHeaderContainer").slideDown(666,function(){o(p("div.giftFormContainer"))})}),document.addEventListener("click",function(c){var d=p(c.target).closest("button, clickTarget");if(d)if(d.hasClass("processDonation")){if(window.mwdspace.donationInProgress)return alert("There's already a donation processing."),!1;var e=c.target.getAttribute("data-working");e&&p(c.target).addClass("blocked").html(e);if("object"==typeof Spreedly){var f={first_name:p("div.giftFormContainer input[name=\"donorFirstname\"]").val(),last_name:p("div.giftFormContainer input[name=\"donorLastname\"]").val(),month:p("div.giftFormContainer select[name=\"payCardExpireMonth\"]").val(),year:p("div.giftFormContainer select[name=\"payCardExpireYear\"]").val(),email:p("div.giftFormContainer input[name=\"donorEmail\"]").val(),zip:p("div.giftFormContainer input[name=\"donorPostCode\"]").val()};console.log("tokenOptions",f),Spreedly.tokenizeCreditCard(f)}window.mwdspace.transactionLayer.startDonation({amount:6.66},function(a){console.log("SUCCESS FUNCTION",a);var b=c.target.getAttribute("data-success");p(c.target).removeClass("blocked").html(b)},function(a){console.log("FAIL FUNCTION",a);var b=c.target.getAttribute("data-error");p(c.target).removeClass("blocked").addClass("error").html(b)})}else d.hasClass("goNextStep")?a():d.hasClass("goPreviousStep")&&b()})})();