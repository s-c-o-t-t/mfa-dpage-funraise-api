"use strict";(function(){console.log("mwd-donate-widget.js v18.7.15"),window.mwdspace=window.mwdspace||{},window.mwdspace.MFA_Funraise_Widget=function(e){var t=this;if("undefined"==typeof e)var e={};t.isStarted=!1,t.isLoaded=!1,t.codeVersion="1.0.0",t.targetElement={},t.promises={},t.intervals={},t.defaults={},t.options={},t.setSystemValues(),t.setUserOptions(e);var n=document.querySelectorAll(t.options.element);return n?1<n.length?(console.warn("MFA_Funraise_Widget(): using 1st of multiple target elemets found:",t.options.element),!1):void(t.targetElement=n[0]):(console.error("MFA_Funraise_Widget(): specified target element not found:",t.options.element),!1)},window.mwdspace.MFA_Funraise_Widget.prototype.setSystemValues=function(){var e=this;"localhost"==window.location.hostname?(e.baseWidgetUrl="http://localhost:8888/mwd/mfa/mfa-dpage-funraise-api/dist/",console.warn("USING TEST BASE URL",e.baseWidgetUrl)):e.baseWidgetUrl="https://quiz.mercyforanimals.org/donate-widget/"+e.codeVersion+"/",e.mainStylesUrl=e.baseWidgetUrl+"css/mwd-donate-widget.css",e.mainHtmlUrl=e.baseWidgetUrl+"mwd-donate-widget.html",e.fontAwesome4Url="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css",e.fontAwesome5Url="https://use.fontawesome.com/releases/v5.1.0/css/all.css",e.specialSelectStylesUrl="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css",e.specialSelectScriptUrl="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js",e.defaults.paymentTokenizerApiKey="ECDNSGhIR0fYQisIc1PHH7NX0pN",e.defaults.minimumGiftAmount=5,e.defaults.listSingleGiftAskString=[25,50,75,100],e.defaults.listMonthlyGiftAskString=[5,10,15,20],e.payMethodIconHtml={card:"<i class=\"fa far fa-credit-card\" aria-hidden=\"true\"></i>",visa:"<i class=\"fa fab fa-cc-visa\" aria-hidden=\"true\"></i>",mastercard:"<i class=\"fa fab fa-cc-mastercard\" aria-hidden=\"true\"></i>",amex:"<i class=\"fa fab fa-cc-amex\" aria-hidden=\"true\"></i>",discover:"<i class=\"fa fab fa-cc-discover\" aria-hidden=\"true\"></i>",bitcoin:"<i class=\"fa fab fa-bitcoin fa-btc\" aria-hidden=\"true\"></i>"}},window.mwdspace.MFA_Funraise_Widget.prototype.setUserOptions=function(e){var t=this;if("undefined"==typeof e)var e={};if("string"==typeof e.element&&e.element.trim())t.options.element=e.element;else return console.error("MFA_Funraise_Widget(): invalid options - No target element:",e),!1;"string"==typeof t.options.organizationId&&t.options.organizationId.trim()||(t.options.organizationId="fcb4d538-ca92-4212-86cc-06d8ac929c4d"),"number"==typeof t.options.formId&&"string"==typeof t.options.formId&&t.options.formId||(t.options.formId=1194),t.options.listSingleGiftAskString="object"==typeof e.listSingleGiftAskString&&0<e.listSingleGiftAskString.length?e.listSingleGiftAskString:t.defaults.listSingleGiftAskString,t.options.listMonthlyGiftAskString="object"==typeof e.listMonthlyGiftAskString&&0<e.listMonthlyGiftAskString.length?e.listMonthlyGiftAskString:t.defaults.listMonthlyGiftAskString,t.options.currencyFilter=!("object"!=typeof e.currencies)&&e.currencies,t.options.payMethodFilter=!("object"!=typeof e.payMethods)&&e.payMethods,t.options.fontAwesomeVersion=isNaN(e.fontAwesomeVersion)?null:parseInt(e.fontAwesomeVersion),t.options.labelOverrideObject=!1,t.options.labelOverrideFileUrl=!1,"string"==typeof e.labelOverride&&e.labelOverride.trim()?t.options.labelOverrideFileUrl=e.labelOverride:"object"==typeof e.labelOverride&&(t.options.labelOverrideObject=e.labelOverride),t.options.onLoad=!("function"!=typeof e.onLoad)&&e.onLoad,t.options.onDonation=!("function"!=typeof e.onDonation)&&e.onDonation},window.mwdspace.MFA_Funraise_Widget.prototype.start=async function(){var e=this;if(e.isStarted)return void console.warn("MFA_Funraise_Widget already started");e.isStarted=!0,e.targetElement.innerHTML="";var t=e.getFontIconStyles(),n=e.options.styleSheets||e.mainStylesUrl,a=e.linkExternalStylesheet(n);e.linkExternalStylesheet(e.specialSelectStylesUrl),await Promise.all([t,a]);var i,r,o=e.loadFile(e.mainHtmlUrl),d=e.linkExternalScript(e.baseWidgetUrl+"js/shared-utils.js");if([i,r]=await Promise.all([o,d]),!i)return void console.error("MFA_Funraise_Widget.start() - unable to load base HTML");var s=document.createElement("div");s.id="mfaDonationWidgetContainer",s.style.opacity=0,e.targetElement.appendChild(s),s.innerHTML=i,setTimeout(function(){s.className="reveal"},1),e.promises.spreedlyIframeScript=e.linkExternalScript("https://core.spreedly.com/iframe/iframe-v1.min.js");var l=await e.linkExternalScript("https://code.jquery.com/jquery-3.3.1.min.js"),c=e.linkExternalScript(e.specialSelectScriptUrl),p=e.linkExternalScript(e.baseWidgetUrl+"js/gift-utilities.js"),m=e.linkExternalScript(e.baseWidgetUrl+"js/transaction-system-layer.js");await Promise.all([p,m,c]),e.jquery=l?jQuery.noConflict():$||{},e.run()},window.mwdspace.MFA_Funraise_Widget.prototype.run=async function(){function e(){switch(mwdspace.currentStepName){case"giftAmount":if(a())return n("donorInfo"),!0;break;case"donorInfo":if(i())return"card"==window.mwdspace.userInputData.payMethod?(n("cardInfo"),!0):(h(),y());break;case"cardInfo":if(r())return h(),N();}return!1}function t(){switch(mwdspace.currentStepName){case"donorInfo":n("giftAmount");break;case"cardInfo":n("donorInfo");}}function n(e){window.mwdspace.currentStepName="",e=window.mwdspace.sharedUtils.ensureString(e),e||(e=window.mwdspace.sharedUtils.getSessionValue("savedStepName"),!e&&(e="giftAmount")),K.find("div.loadingDisplay").hide();for(var t,n=0;n<J.length;n++)if(t=J[n].getAttribute("data-step-name"),t==e){if("donorInfo"===e||"cardInfo"===e?(K.find("div.giftFormHeaderContainer").show(),Q.fadeIn(888)):Q.hide(),"donorInfo"==e){var a;switch(window.mwdspace.userInputData.payMethod){case"card":console.warn("Making next button"),a="Enter Payment Information";try{V.labelOverride.button.goPaymentInfo&&(a=V.labelOverride.button.goPaymentInfo)}catch(e){}break;case"bitcoin":console.warn("Making submit button"),a="Submit Donation";try{V.labelOverride.button.mainSubmit&&(a=V.labelOverride.button.mainSubmit)}catch(e){}}V.setElementText("button.goPaymentInfo",a)}B(J[n]).fadeIn(666,function(){H(K)}),window.mwdspace.currentStepName=t,"confirmation"==e&&window.mwdspace.sharedUtils.removeSessionValue("savedStepName")}else B(J[n]).hide()}function a(){var e=!0;if("number"!=typeof Y.baseAmount||Y.baseAmount<window.mwdspace.minimumAmount){console.warn("baseAmount is invalid",Y.baseAmount),e=!1;var t="Please enter a valid gift amount";try{t=V.labelOverride.gift.error.invalidAmount||t}catch(e){}o("giftAmount",t,!0)}else o("giftAmount");return"string"!=typeof Y.giftCurrency&&(console.warn("Currency is invalid",Y.giftCurrency),e=!1),"string"!=typeof Y.payMethod&&(console.warn("Pay Method is invalid",Y.payMethod),e=!1),"string"!=typeof Y.giftFrequency&&(console.warn("Gift frequency is invalid",Y.giftFrequency),e=!1),e}function i(){console.log(">>> checkStepDonor()");var e=!0;return K.find("section.step[data-step-name='donorInfo'] .changeWatch").each(function(){"donorCountry"!=B(this).attr("name")&&"none"!=B(this).css("display")&&B(this).trigger("change")}),Y.donorCountry=K.find("div.billingInfoContainer select[name='donorCountry']").val()||null,"string"!=typeof Y.donorFirstName&&(console.warn("donorFirstName is invalid",Y.donorFirstName),e=!1),"string"!=typeof Y.donorLastName&&(console.warn("donorLastName is invalid",Y.donorLastName),e=!1),"string"!=typeof Y.donorEmail&&(console.warn("donorEmail is invalid",Y.donorEmail),e=!1),"undefined"!=typeof Y.donorPhone&&"string"!=typeof Y.donorPhone&&(console.warn("donorPhone is invalid",Y.donorPhone),e=!1),"string"!=typeof Y.donorStreet&&(console.warn("donorStreet is invalid",Y.donorStreet),e=!1),"string"!=typeof Y.donorRegion&&(console.warn("donorRegion is invalid",Y.donorRegion),e=!1),"string"!=typeof Y.donorPostCode&&(console.warn("donorPostCode is invalid",Y.donorPostCode),e=!1),"string"!=typeof Y.donorCountry&&(console.warn("donorCountry is invalid",Y.donorCountry),e=!1),"on"==Y.companyMatch&&("string"!=typeof Y.donorMatchCompany&&(console.warn("donorMatchCompany is invalid",Y.donorMatchCompany),e=!1),"string"!=typeof Y.donorMatchEmail&&(console.warn("donorMatchEmail is invalid",Y.donorMatchEmail),e=!1)),e}function r(){console.log(">>> checkStepCard()");var e=!0;K.find("section.step[data-step-name='cardInfo'] .changeWatch").trigger("change");var t=K.find("div.payInfoContainer div#cardNumberTarget");!0===Y.hasValidCardNumber?t.removeClass("invalid"):(e=!1,t.addClass("invalid"),console.warn("hasValidCardNumber is invalid",Y.hasValidCardNumber));var n=K.find("div.payInfoContainer div#cardCvvTarget");return!0===Y.hasValidCardCvv?n.removeClass("invalid"):(e=!1,n.addClass("invalid"),console.warn("hasValidCardCvv is invalid",Y.hasValidCardCvv)),"string"!=typeof Y.payCardExpireMonth&&(console.warn("payCardExpireMonth is invalid",Y.payCardExpireMonth),e=!1),"string"!=typeof Y.payCardExpireYear&&(console.warn("payCardExpireYear is invalid",Y.payCardExpireYear),e=!1),e}function o(e,t,n){if("undefined"==typeof e)var e="";if("undefined"==typeof t)var t="";if("undefined"==typeof n)var n=!1;e||console.log("showStepFeedback() given invalid input",e,t);var a=B("section[data-step-name=\""+e+"\"] div.userFeedback p.message");t||n?(a.html(t||"Sorry, an unknown error occured").fadeIn(444),n?a.addClass("error"):a.removeClass("error")):a.fadeOut(222,function(){B(this).html(""),B(this).removeClass("error")})}function d(e,t){if("undefined"==typeof t)var t={};var n=!0,a=null;if(t.validationPattern=e.attr("data-validation"),t.validationPattern&&(n=s(e,t)),n){var i=e.attr("type");"checkbox"==i||"radio"==i?e.prop("checked")&&(a=t.value):a=t.value}Y[t.name]=a,window.mwdspace.sharedUtils.setSessionValue(t.name,t.value)}function s(e,t){if("undefined"==typeof t)var t={};var n=!0,a="";switch("undefined"!=typeof t.value&&null!==t.value&&(a=t.value+""),t.validationPattern){case"email":n=a.match(/^[\w|\.|\-|\_]+@[\w|\.|\-|\_]+\.[a-z]{2,}$/i);break;default:var i=new RegExp(t.validationPattern,"i");n=a.match(i);}return n?(e.removeClass("invalid"),!0):(e.addClass("invalid"),!1)}function l(e){var t=B(e.target),n=C(t.val())||0;if(c({baseAmount:n}),K.find("div.giftOption input").removeClass("selected"),t.addClass("selected"),"change"==e.type&&K.find("div.giftFormHeaderContainer").slideDown(666,function(){H(K)}),"change"==e.type||"blur"==e.type){if("giftAmountFreeform"==t.attr("name")){var a=C(n)||0,i=a.toFixed(2);i!=n&&t.val(i)}a<window.mwdspace.minimumAmount?X.addClass("invalid"):X.removeClass("invalid"),K.find("div.giftOption input[type='radio']").prop("checked",!1)}}function c(e){if("undefined"==typeof e)var e={};try{Y.totalAmount=Y.totalAmount||0,Y.baseAmount=Y.baseAmount||0,Y.extraAmount=Y.extraAmount||0,Y.extraPercent=Y.extraPercent||0,"undefined"!=typeof e.baseAmount&&(Y.baseAmount=parseFloat(e.baseAmount)||0),"undefined"!=typeof e.extraPercent&&(Y.extraPercent=parseFloat(e.extraPercent)||0),Y.extraAmount=Y.baseAmount*Y.extraPercent/100,Y.totalAmount=Y.baseAmount+Y.extraAmount;var t=Y.totalAmount.toFixed(2).split(".");K.find("div.amountDisplay span.displayWholeAmount").text(t[0]||"??"),K.find("div.amountDisplay span.displaySubAmount").text("."+t[1]||"??"),window.mwdspace.sharedUtils.setSessionValue("baseAmount",Y.baseAmount),window.mwdspace.sharedUtils.setSessionValue("extraPercent",Y.extraPercent)}catch(e){console.log("updateGiftAmount() caught error: ",e.message)}}function p(){console.log(">>> updateCurrency()");for(var e,t=ne.val(),n=" (?) ",a=0;a<window.mwdspace.validCurrencyList.length;a++)if(e=window.mwdspace.validCurrencyList[a],e.code==t&&e.symbol){n=e.symbol;break}K.find("span.currencySymbol").html(n)}function m(){for(var e,t=Z.val(),n=0;n<window.mwdspace.validPayMethodList.length;n++)if(e=window.mwdspace.validPayMethodList[n],e.code==t){window.mwdspace.minimumAmount=e.minimumAmount,e.frequencies&&u(e.frequencies);break}}function u(e){if("object"!=typeof e||1>e.length)return void console.warn("filterFrequencyButtons() ignoring invalid frequency list",e);var t=0,n=!1;K.find("div.giftFrequencyContainer div.fancyRadioButton input[type='radio']").each(function(){0<=e.indexOf(B(this).val())?(B(this).closest("div.fancyRadioButton").show(),t++):(B(this).prop("checked")&&(n=!0),B(this).closest("div.fancyRadioButton").hide())}),1>t?K.find("div.giftFrequencyContainer div.fancyRadioButton").show():1==t&&K.find("div.giftFrequencyContainer div.fancyRadioButton").hide()}function g(){v()}function f(e,t){if("undefined"==typeof e||!e)return void console.log("setInputFromUrl() given invalid urlKey",e);if("undefined"==typeof t||!t)return void console.log("setInputFromUrl() given invalid selector",t);var n=window.mwdspace.sharedUtils.getUrlParameter(e);n&&K.find("section.step input[name='"+t+"'], section.step select[name='"+t+"']").val(n).trigger("change")}function h(){console.log("buildTransactionSendData() START");try{window.mwdspace.transactionSendData={};var e=window.mwdspace.transactionSendData,t=window.mwdspace.userInputData;switch(console.log("buildTransactionSendData() userData",t),e.organizationId=V.options.organizationId||null,e.formId=V.options.formId?V.options.formId+"":"",e.formAllocationId=V.options.formAllocationId||null,"live"!=window.mwdspace.sharedUtils.getUrlParameter("api")&&(e.organizationId="1e78fec4-8fd0-4a3e-b82b-866c29012531",e.formId=10),e.bank_account_holder_type="personal",e.bank_account_number="",e.bank_account_type="checking",e.bank_name="",e.bank_routing_number="",e.comment="",e.payment_method_token="",e.tags=null,e.first_name=t.donorFirstName||"",e.last_name=t.donorLastName||"",e.email=t.donorEmail||"",e.phone=t.donorPhone||"",e.address=t.donorStreet||"",e.city=t.donorCity||"",e.state=t.donorRegion||"",e.postalCode=t.donorPostCode||"",e.country=t.donorCountry||"",e.amount=t.totalAmount||0,e.baseAmount=(+(t.baseAmount||0)).toFixed(2),e.tipAmount=(+(t.extraAmount||0)).toFixed(2),e.tipPercent=(+(t.extraPercent||0)).toFixed(2),t.giftFrequency){case"single":e.recurring=!1,e.frequency="o";break;case"monthly":e.recurring=!0,e.frequency="m";break;default:e.recurring=null,e.frequency="";}return e.currency=t.giftCurrency||"",e.paymentType=t.payMethod||"","card"==e.paymentType&&(e.month=t.payCardExpireMonth||"",e.year=t.payCardExpireYear||""),e.donateDouble=!0===t.isCompanyMatch,e.company=t.companyMatchName||"",e.employeeEmail=t.companyMatchEmail||"",console.log("buildTransactionSendData() sendData",e),!0}catch(e){console.log("buildTransactionSendData() caught error: ",e.message)}return!1}function y(){return!!window.mwdspace.transactionLayer.validateSendData(window.mwdspace.transactionSendData)&&(console.log("sendTransaction() SENDING",window.mwdspace.transactionSendData),D(),window.mwdspace.transactionLayer.startDonation(window.mwdspace.transactionSendData,function(e){var t=e.json||{};if(console.log("transactionData",t),"card"==t.type){var n=t.status+"";n.match(/complete/i)?W():G("The server appears to have had an error processing this card transaction, and reported status \""+n+"\".")}else"bitcoin"==t.type?_(t):"live"==window.mwdspace.sharedUtils.getUrlParameter("api")?(console.warn("Unrecognized type property in server response",e),G("Unrecognized response from the server")):W()},function(e){console.warn("Donation received fail response from server",e);var t;if(e.text){t="System message:";try{t=window.mwdspace.labelOverride.transactionError.error.systemMessage||t}catch(e){}t+=" "+e.text}else{t="The server was unable to process the transaction, but provided no explanation.";try{t=window.mwdspace.labelOverride.transactionError.error.unknown||t}catch(e){}try{t+=" <span class='hint'>(HTML status: "+(e.status||"[No Status]")+" "+(e.statusText||"[No Text]")+")</span>"}catch(e){console.log("Caught error: ",e.message)}}G(t)}),!0)}function v(){console.log(">>> getGiftString()");var e={};"monthly"==window.mwdspace.userInputData.giftFrequency?V.options.listMonthlyGiftAskString&&(e.giftStringList=V.options.listMonthlyGiftAskString,!V.isMonthlyOnlyPage&&(e.calculateAsMonthly=!0)):V.options.listSingleGiftAskString&&(e.giftStringList=V.options.listSingleGiftAskString);var t=window.mwdspace.giftUtils.processGiftStringList(e);b(t),p()}function b(e){if("undefined"==typeof e)var e=[];try{if(!e||1>e.length)throw new Error("Invalid gift string list given");var t=K.find("div.fixedAmountContainer");if(1!==t.length)throw new Error("Unable to identify the fixed gift amount container");t.empty();for(var n,a,r,o=null,d=0;d<e.length;d++)a=e[d],r=window.mwdspace.sharedUtils.makeUniqueId("amount-"+d),!o&&(a+"").match(/\*/)&&(o=r),n=w(a,{id:r}),n?t.append(n):console.warn("Unable to add fixed gift button:",a);o?t.find("div.giftAmountContainer input#"+o).prop("checked",!0).trigger("change"):t.find("div.giftAmountContainer input[name='giftAmountFixed']").eq(1).prop("checked",!0).trigger("change")}catch(e){console.error("Unable to build the fixed gift buttons",e)}}function w(e,t){if("undefined"==typeof t)var t={};"object"!=typeof t&&(t={},console.warn("buildGiftStringButton(): ignoring invalid option object",t));var n=null;try{var a={amount:C(e),displayText:S(e)};if(!a.amount||!a.displayText)throw new Error("Invalid gift string amount");n=document.createElement("div"),B(n).addClass("giftOption fixed fancyRadioButton");var i=document.createElement("input");i.setAttribute("type","radio"),i.setAttribute("name","giftAmountFixed"),i.setAttribute("value",a.amount),t.id&&i.setAttribute("id",t.id),n.appendChild(i);var r=document.createElement("label");t.id&&r.setAttribute("for",t.id),n.appendChild(r);var o=document.createElement("span");B(o).addClass("currencySymbol"),r.appendChild(o);var d=document.createElement("span");B(d).addClass("displayAmount"),d.innerHTML=a.displayText||"Unknown",r.appendChild(d)}catch(t){console.error("Error building the button for fixed amount:",e,t)}return n}function C(e){if("undefined"==typeof e){console.warn("cleanCurrency() given empty input");var e=""}e=""+e;var t=parseFloat(e.replace(/[^0-9|\.]/g,""));return isNaN(t)?(console.log("cleanCurrency() defaulting invalid input to 0.00",e),0):Math.round(100*t)/100}function S(e){if("undefined"==typeof e)var e="";e=""+e;var t=C(e);return t=t.toFixed(2),t=t.replace(/\.00$/g,""),t}function A(e){var t=null;try{e.code&&(t=document.createElement("option"),t.setAttribute("value",e.code),t.innerText=e.code+" "+(e.name||""))}catch(t){console.error("Unable to build the option element for currency:",e)}return t}function E(e){var t=null;try{e.code&&(t=document.createElement("option"),t.setAttribute("value",e.code),t.setAttribute("data-label-id","gift.payMethod."+e.code),t.innerText=e.description||"Unknown")}catch(t){console.error("Unable to build the option element for method:",e)}return t}function I(e,t){if("undefined"==typeof t)var t={};"object"!=typeof t&&(t={},console.warn("buildFrequencyButton(): ignoring invalid option object",t));var n=null;try{if(e.code){n=document.createElement("div"),B(n).addClass("fancyRadioButton");var a=document.createElement("input");B(a).addClass("changeWatch"),a.setAttribute("type","radio"),a.setAttribute("name","giftFrequency"),a.setAttribute("value",e.code),t.id&&a.setAttribute("id",t.id),n.appendChild(a);var i=document.createElement("label");i.setAttribute("data-label-id","gift.frequency."+e.code),i.innerHTML=e.name||"Unknown",t.id&&i.setAttribute("for",t.id),n.appendChild(i)}}catch(t){console.error("Error building the button for frequency:",e,t)}return n}function x(){if("undefined"==typeof e)var e={};"object"!=typeof e&&(e={},console.warn("prepareRegionInput(): ignoring invalid option object",e));try{for(var t,n=K.find("select[name=\"donorCountry\"]").val(),a=0;a<window.mwdspace.validCountryList.length;a++)if(t=window.mwdspace.validCountryList[a],(n==t.code||n==t.name)&&t.regions&&F(t.regions))return}catch(e){console.error("Unable to prepare the region input method",e)}k()}function k(){ee.hide(),te.val("").show().trigger("change")}function F(e){if(te.hide(),ee.val("").show().trigger("change"),"undefined"==typeof e)return console.warn("buildRegionSelect(): no regions object",e),!1;if("object"!=typeof e||1>e.length)return console.warn("buildRegionSelect(): invalid regions object",e),!1;try{if(1!==ee.length)return console.error("Unable to identify the region select dropdown"),!1;var t,n,a=0;ee.empty(),t=M("State/Region...",{"data-label-id":"donor.regionPlaceholder",value:""}),ee.append(t);for(var r=0;r<e.length;r++)n=e[r],t=M(n.name),t?(ee.append(t),a++):console.warn("Unable to add region:",n);if(0<a)return!0}catch(e){console.error("Unable to build the region select dropdown",e)}return!1}function M(e,t){if("undefined"==typeof t)var t={};"object"!=typeof t&&(console.warn("buildRegionOption() ignoring invalid attributes object",t),t={});try{if("string"==typeof e&&e.trim()){var n=null;for(var a in n=document.createElement("option"),n.innerText=e,t)n.setAttribute(a,t[a]);return n}}catch(e){console.error("Unable to build the option element for region:",region)}return null}function L(e,t){if("undefined"==typeof t)var t={};"object"!=typeof t&&(console.warn("buildCountryOption() ignoring invalid attributes object",t),t={});var n=null;try{e.code&&(n=document.createElement("option"),n.innerText=e.name)}catch(t){console.error("Unable to build the option element for country:",e)}for(var a in t)n.setAttribute(a,t[a]);return n}function U(e,t){if("undefined"==typeof t)var t={};"object"!=typeof t&&(console.warn("buildRegionOption() ignoring invalid attributes object",t),t={});var n=null;try{if("number"!=typeof e&&"string"!=typeof e&&!e)console.error("Invalid month given:",e);else{try{var a=parseInt(e);!isNaN(a)&&0<=a&&10>a&&(e="0"+a)}catch(e){}for(var i in n=document.createElement("option"),t)n.setAttribute(i,t[i]);n.innerText=e}}catch(t){console.error("Unable to build the option element for month:",e)}return n}function P(e,t){if("undefined"==typeof t)var t={};"object"!=typeof t&&(console.warn("buildRegionOption() ignoring invalid attributes object",t),t={});var n=null;try{if("number"!=typeof e&&"string"!=typeof e&&!e)console.error("Invalid year given:",e);else{if("undefined"==typeof e);for(var a in n=document.createElement("option"),t)n.setAttribute(a,t[a]);n.innerText=e}}catch(t){console.error("Unable to build the option element for year:",e)}return n}function T(){Spreedly.setFieldType("number","text"),Spreedly.setNumberFormat("prettyFormat"),Spreedly.setStyle("number","font-size:16px;color:#333;"),Spreedly.setStyle("cvv","font-size:16px;color:#333;");var e="Card",t="cvv";try{V.labelOverride.cardInfo.cardNumberPlaceholder&&(e=V.labelOverride.cardInfo.cardNumberPlaceholder)}catch(e){}try{V.labelOverride.cardInfo.cvvPlaceholder&&(t=V.labelOverride.cardInfo.cvvPlaceholder)}catch(e){}Spreedly.setPlaceholder("number",e),Spreedly.setPlaceholder("cvv",t)}function O(e,t){e?ae.find("span.cardNumberValidity").removeClass("invalid").addClass("valid").html("<i class=\"fa fas fa-check-circle\"></i>"):ae.find("span.cardNumberValidity").removeClass("valid").addClass("invalid").html("<i class=\"fa fas fa-times\"></i>");var n=ae.find("span.cardType");"visa"===t?n.html(V.payMethodIconHtml.visa).addClass("known"):"master"===t?n.html(V.payMethodIconHtml.mastercard).addClass("known"):"american_express"===t?n.html(V.payMethodIconHtml.amex).addClass("known"):"discover"===t?n.html(V.payMethodIconHtml.discover).addClass("known"):n.html(V.payMethodIconHtml.card).removeClass("known")}function N(){if(Y.hasValidCardNumber&&Y.hasValidCardCvv&&Y.payCardExpireMonth&&Y.donorFirstName&&Y.donorLastName&&Y.payCardExpireYear){if("object"==typeof Spreedly){var e={first_name:Y.donorFirstName,last_name:Y.donorLastName,month:Y.payCardExpireMonth,year:Y.payCardExpireYear};return Y.donorEmail&&(e.email=Y.donorEmail),Y.donorPhone&&(e.phone_number=Y.donorPhone),Y.donorStreet&&(e.address1=Y.donorStreet),Y.donorCity&&(e.city=Y.donorCity),Y.donorRegion&&(e.state=Y.donorRegion),Y.donorPostCode&&(e.zip=Y.donorPostCode),Y.donorCountry&&(e.country=Y.donorCountry),console.log(">> CALLING tokenizeCreditCard",e),Spreedly.tokenizeCreditCard(e),!0}console.error("NO SPREEDLY OBJECT")}else console.error("SPREEDLY FIELD NOT READY");return!1}function R(e){for(var t=0;t<e.length;t++);}function D(){var e="";if("bitcoin"==window.mwdspace.userInputData.payMethod)e=V.payMethodIconHtml.bitcoin;else if("card"==window.mwdspace.userInputData.payMethod)switch(window.mwdspace.userInputData.payCardType){case"visa":e=V.payMethodIconHtml.visa;break;case"mastercard":case"master":case"mc":e=V.payMethodIconHtml.mastercard;break;case"amex":case"american_express":case"americanexpress":e=V.payMethodIconHtml.amex;break;case"discover":case"disc":e=V.payMethodIconHtml.discover;}var t=K.find("section[data-step-name=\"processing\"]");t.find("span.processingPaySymbol").html(e),n("processing")}function _(e){if("object"!=typeof e)return console.warn("prepAndShowBitcoinStep() given invalid input",e),void G("Unable to display Bitcoin invoice screen");var t=K.find("section[data-step-name=\"bitcoinInvoice\"]");t.find("span.bitcoinStatus").html(e.invoice_status),t.find("img.scanCode").attr("src","data:image/png;charset=utf-8;base64,"+e.img_data),t.find("span.bitcoinAmount").html(e.alt_amount),t.find("span.bitcoinWalletLink").html(e.checkout_url),t.find("a.bitcoinWalletLink").attr("href",e.checkout_url),j(e.exp),V.intervals.bitcoinTimer=setInterval(function(){j(e.exp)},1e3),n("bitcoinInvoice"),V.intervals.bitcoinStatusChecker=setInterval(function(){q(e.transaction_id)},3e4)}function j(e){if("undefined"==typeof e)var e=null;var t="Unknown time";try{var n=0,a=0,i=new Date(e).getTime(),r=new Date().getTime(),o=(i-r)/1e3/60;0<o?(n=parseInt(o),a=parseInt(60*(o-n)),2>o&&ie.closest("div.bitcoinStatusDisplay").addClass("warning")):(ie.closest("div.bitcoinStatusDisplay").addClass("error"),clearInterval(V.intervals.bitcoinTimer)),10>a&&(a="0"+a),t=n.toFixed()+":"+a}catch(e){console.warn("updateBitcoinTimer() caught error",e.message)}ie.html(t)}async function q(e){if(console.log(">>> checkBitcoinPaymentStatus()"),"undefined"==typeof e){console.warn("checkBitcoinPaymentStatus() given empty url");var e=null}var t="https://test.bitpay.com/invoices/";"live"==window.mwdspace.sharedUtils.getUrlParameter("data")&&(t="https://bitpay.com/invoices/");var n,a=K.find("div.bitcoinContainer");if(console.log("SENDING LIVE BITCOIN POLL REQUEST"),n=await new Promise(function(n){console.log(">>> checkBitcoinPaymentStatus() INSIDE PROMISE"),"string"!=typeof e&&(console.warn("checkBitcoinPaymentStatus() given invalid url type:",typeof e,e),n(null)),console.log("checkBitcoinPaymentStatus() start:",e);var a=encodeURI(t+e),i=new XMLHttpRequest;i.addEventListener("load",function(e){var t=e.target.responseText||e.target.response||null,a=window.mwdspace.sharedUtils.safeJsonParse(t);a&&a.data||(console.log("checkBitcoinPaymentStatus(): invalid response",e),n(null)),n(a.data)}),i.addEventListener("error",function(e){console.error("checkBitcoinPaymentStatus() ERROR EVENT",a,e),n(null)}),i.open("get",a,!0),i.setRequestHeader("Accept","application/json"),i.send()}),!n){var i=document.createElement("div");return i.innerHTML="Warning: Unable to verify the status of this invoice ("+new Date().toLocaleTimeString()+"). Will try again shortly.</div>",B(i).addClass("spacingContainer error"),void a.find("div.bitcoinFeedback").append(i)}switch(console.log("checkBitcoinPaymentStatus() RESPONSE",n),a.find("div.bitcoinStatus").html(n.status),n.status){case"paid":case"confirmed":case"complete":W(),clearInterval(V.intervals.bitcoinStatusChecker);break;case"expired":G("The Bitcoin invoice expired before payment was received."),clearInterval(V.intervals.bitcoinStatusChecker);break;case"invalid":var i=document.createElement("div");i.innerHTML="The invoice received payments, but is listed as invalid.",B(i).addClass("spacingContainer error"),a.find("div.bitcoinFeedback").append(i);break;case"new":"live"!=window.mwdspace.sharedUtils.getUrlParameter("data"),W(),clearInterval(V.intervals.bitcoinStatusChecker);}}function W(e){if("undefined"==typeof e)var e={};var t=K.find("section[data-step-name=\"confirmation\"] span.confirmationMessage"),a="Thank you";try{V.labelOverride.confirmation.thankYouText&&(a=V.labelOverride.confirmation.thankYouText)}catch(e){}t.html(a);try{if(window.mwdspace.userInputData.donorFirstName){var i=document.createElement("strong");i.innerHTML=window.mwdspace.userInputData.donorFirstName,t.append(", "),t.append(i)}}catch(e){}if(t.append("!"),n("confirmation"),V.options.onDonation)try{console.log("Running onDonation function"),V.options.onDonation(window.mwdspace.userInputData)}catch(e){console.warn("Caught error from onDonation function: ",e.message)}}function G(e){if("undefined"==typeof e)var e={};var t=K.find("section[data-step-name=\"transactionError\"]");t.find("span.errorMessage").html(e),n("transactionError")}function H(e){if(V.isLoaded){e=B(e);var t=B(window).scrollTop(),n=B(window).height(),a=t,i=(e.outerHeight()-e.innerHeight())/2;i=0>=i?4:i;var r=e.offset().top+i,o=r+e.innerHeight();return e.innerHeight()>n?void B("html,body").animate({scrollTop:r,easing:"ease"},444):a>r?void B("html,body").animate({scrollTop:r,easing:"ease"},999):void(a+n<o&&B("html,body").animate({scrollTop:o-n+i,easing:"ease"},999))}}var V=this;"function"!=typeof V.jquery&&(console.error("jQuery (thisWidget.jquery) not found"),exit());var B=V.jquery;window.mwdspace.userInputData={},window.mwdspace.transactionSendData={};var Y=window.mwdspace.userInputData;window.mwdspace.minimumAmount=V.defaults.minimumGiftAmount,window.mwdspace.pageIdPrefix="widget"+V.options.formId;var z=V.options.paymentTokenizerApiKey||V.defaults.paymentTokenizerApiKey,K=B("div.giftFormContainer"),J=K.find("section.step"),Q=K.find("button.goPreviousStep"),X=K.find("input[name=\"giftAmountFreeform\"]"),Z=K.find("select[name=\"payMethod\"]"),ee=K.find("select[name=\"donorRegion\"]"),te=K.find("input[name=\"donorRegion\"]"),ne=K.find("select[name=\"giftCurrency\"]"),ae=K.find("div.payInfoContainer div.cardNumberFeedback"),ie=K.find("div.bitcoinContainer span.bitcoinTimeRemaining");V.promises.labelOverrideLoad=V.prepareLabelOverride(),function(){try{if(!window.mwdspace.validPayMethodList)throw new Error("List of valid payment methods not found");if(1!==Z.length)throw new Error("Unable to identify the payment method select dropdown");for(var e,t=0;t<window.mwdspace.validPayMethodList.length;t++)e=E(window.mwdspace.validPayMethodList[t]),e?Z.append(e):console.warn("Unable to add payment method:",window.mwdspace.validPayMethodList[t]);1<window.mwdspace.validPayMethodList.length?Z.show():Z.hide()}catch(e){console.error("Unable to build the payment method select dropdown",e)}}(),function(e){if("undefined"==typeof e)var e={};"object"!=typeof e&&(e={},console.warn("buildCountrySelect(): ignoring invalid option object",e));var t="string"==typeof e.default?e.default:"United States";try{if(!window.mwdspace.validCountryList)throw new Error("List of valid countries not found");var n=K.find("select[name=\"donorCountry\"]");if(n.on("change",x),1!==n.length)throw new Error("Unable to identify the country select dropdown");for(var a,r,o,d=0;d<window.mwdspace.validCountryList.length;d++)o=!0,r=window.mwdspace.validCountryList[d],e.filterList&&(o=R(e.filterList,r.code)),o&&(a=L(r),a?n.append(a):console.warn("Unable to add country:",r));n.val(t).trigger("change")}catch(e){console.error("Unable to build the country select dropdown",e)}}(),function(){try{var e=K.find("select[name=\"payCardExpireMonth\"]");if(1!==e.length)throw new Error("Unable to identify the card expire month select dropdown");var t=U("Month",{value:"","data-label-id":"cardInfo.cardExpireMonthPlaceholder"});e.append(t);for(var n=1;12>=n;n++)t=U(n),t?e.append(t):console.warn("Unable to add card expire month:",n)}catch(e){console.error("Unable to build the card expire month select dropdown",e)}}(),function(){try{var e=new Date;e.setDate(e.getDate()-7);var t=e.getFullYear(),n=K.find("select[name=\"payCardExpireYear\"]");if(1!==n.length)throw new Error("Unable to identify the card expire year select dropdown");var a=P("Year",{value:"","data-label-id":"cardInfo.cardExpireYearPlaceholder"});n.append(a);for(var i=t;i<t+20;i++)a=P(i),a?n.append(a):console.warn("Unable to add card expire year:",i)}catch(e){console.error("Unable to build the card expire year select dropdown",e)}}(),async function(){V.promises.spreedlyIframeScript&&(await V.promises.spreedlyIframeScript);var e="Search by company name";try{V.labelOverride.donor.matchCompanyPlaceholder&&(e=V.labelOverride.donor.matchCompanyPlaceholder||e)}catch(e){}var t=B("select[name=\"donorMatchCompany\"]");return"function"==typeof t.select2?void t.select2({minimumInputLength:3,delay:400,placeholder:e,width:"100%",ajax:{url:"https://platform.funraise.io/api/v1/ddcompanies",data:function(e){var t={q:e.term};return t},processResults:function(e){var t={results:[]};if("object"==typeof e&&e.length)for(var n=0;n<e.length;n++)e[n].name&&t.results.push({id:e[n].name,text:e[n].name});return t}}}):void console.warn("SKIPPING COMPANY MATCH SMART SELECTOR")}(),function(){B(document).on("change blur",function(e){var t=B(e.target),n=t.attr("name"),a=t.val(),i=(t.prop("tagName")+"").toLowerCase();if(t.hasClass("changeWatch")&&d(t,{name:n,value:a}),("giftAmountFixed"==n||"giftAmountFreeform"==n)&&"input"==i)l(e);else if("giftExtraPercent"==n&&"input"==i){var r=0;t.prop("checked")&&(r=t.val()),c({extraPercent:r})}else"giftCurrency"==n&&"select"==i?p():"payMethod"==n&&"select"==i?m():"giftFrequency"==n&&"input"==i&&g()}),K.find("div.giftOption input[name=\"giftAmountFreeform\"]").on("focus keyup paste",function(e){l(e)}),ne.trigger("change"),Z.trigger("change"),K.trigger("change"),K.find("input#inputCompanyMatch").on("change",function(){B(this).prop("checked")?K.find("div#collapsableCompanyMatch").slideDown(666,function(){H(K)}):K.find("div#collapsableCompanyMatch").slideUp(333,function(){H(K)})}).trigger("change")}(),function(){try{if(!window.mwdspace.validFrequencyList||1>window.mwdspace.validFrequencyList.length)throw new Error("Invalid list of frequencies given");var e=K.find("div.giftFrequencyContainer");if(1!==e.length)throw new Error("Unable to identify the frequency container");e.find("div.fancyRadioButton").remove();for(var t,n=0;n<window.mwdspace.validFrequencyList.length;n++)t=I(window.mwdspace.validFrequencyList[n],{id:window.mwdspace.sharedUtils.makeUniqueId("frequency-"+n)}),t?e.append(t):console.warn("Unable to add frequency:",window.mwdspace.validFrequencyList[n]);e.find("input[name=\"giftFrequency\"]").eq(0).prop("checked",!0).trigger("change")}catch(e){console.error("Unable to build the frequency buttons",e)}}(),function(e){if("undefined"==typeof e)var e={};"object"!=typeof e&&(e={},console.warn("buildCurrencySelect(): ignoring invalid option object",e));var t="string"==typeof e.default?e.default:"USD";try{if(!window.mwdspace.validCurrencyList)throw new Error("List of valid currencies not found");var n=ne;if(1!==n.length)throw new Error("Unable to identify the currency select dropdown");for(var a,r,o,d=0;d<window.mwdspace.validCurrencyList.length;d++)o=!0,r=window.mwdspace.validCurrencyList[d],e.filterList&&(o=R(e.filterList,r.code)),o&&(a=A(r),a?n.append(a):console.warn("Unable to add currency:",r));n.val(t).trigger("change")}catch(e){console.error("Unable to build the currency select dropdown",e)}}(),function(){f("first","donorFirstName"),f("last","donorLastName"),f("email","donorEmail"),f("phone","donorPhone"),f("street","donorStreet"),f("city","donorCity"),f("postcode","donorPostCode"),f("country","donorCountry"),f("region","donorRegion"),f("currency","giftCurrency"),f("amount","giftAmountFreeform")}(),await V.promises.labelOverrideLoad,V.labelOverride&&V.processLabelOverride(V.labelOverride),n();var re=function(){return new Promise(async e=>{console.log("AWAITING spreedlyIframeScript",V.promises.spreedlyIframeScript),await V.promises.spreedlyIframeScript,console.log("DONE WAITING spreedlyIframeScript",V.promises.spreedlyIframeScript),Spreedly.on("ready",function(){T(),console.log("RESOLVING setupSpreedly"),e()}),Spreedly.on("paymentMethod",function(e,t){if(window.mwdspace.transactionSendData.paymentToken=null,t.errors&&0<t.errors.length){console.warn("SPREEDLY REPORTS paymentMethod ERRORS:");for(var n,a=0;a<t.errors.length;a++)n=t.errors[a],console.warn(n);var r="Error during secure card information transfer. Please try again.";try{r=V.labelOverride.gift.error.tokenizeError||r}catch(e){}o("cardInfo",r,!0)}else window.mwdspace.transactionSendData.paymentToken=e,y(),o("cardInfo")}),Spreedly.on("errors",function(e){console.warn("SPREEDLY REPORTS GENERAL ERRORS:");for(var t,n=0;n<e.length;n++)t=e[n],console.warn(t);var a="Unexpected error with secure card handler";try{a=V.labelOverride.gift.error.generalTokenizerError||a}catch(e){}o("cardInfo",a,!0)}),Spreedly.on("fieldEvent",function(e,t,n,a){"input"==t&&(window.mwdspace.userInputData.hasValidCardNumber=a.validNumber||!1,window.mwdspace.userInputData.hasValidCardCvv=a.validCvv||!1,window.mwdspace.userInputData.payCardType=a.cardType||!1,"number"==e&&O(a.validNumber,a.cardType))}),Spreedly.init(z,{numberEl:"cardNumberTarget",cvvEl:"cardCvvTarget"})})}();if(document.addEventListener("click",function(a){var i=B(a.target).closest("button, .clickTarget");i&&(i.hasClass("goNextStep")?!e()&&(i.addClass("showInvalid"),setTimeout(function(){i.removeClass("showInvalid")},1500)):i.hasClass("goPreviousStep")?t():i.hasClass("errorRestart")&&(window.mwdspace.donationInProgress=!1,n("giftAmount")))}),setTimeout(function(){V.isLoaded=!0},999),console.log("AWAITING promiseSpreedly",re),await re,console.log("READY promiseSpreedly",re),V.options.onLoad)try{console.log("Running onLoad function"),V.options.onLoad()}catch(e){console.warn("Caught error from onLoad function: ",e.message)}},window.mwdspace.MFA_Funraise_Widget.prototype.linkExternalStylesheet=function(e){var t=this;return new Promise(function(n){var a=document.createElement("link");t.targetElement.appendChild(a),a.rel="stylesheet",a.type="text/css";var i=setTimeout(function(){console.log("linkExternalStylesheet() No load after 5s",e),n(!1)},5e3);a.addEventListener("load",function(){clearTimeout(i),n(!0)}),a.addEventListener("error",function(t){console.error("linkExternalStylesheet() ERROR EVENT",e,t),n(!1)}),a.href=encodeURI(e)})},window.mwdspace.MFA_Funraise_Widget.prototype.linkExternalScript=function(e){var t=this;return new Promise(function(n){var a=document.createElement("script");t.targetElement.appendChild(a);var i=setTimeout(function(){console.log("linkExternalScript() No load after 5s",e),n(!1)},5e3);a.addEventListener("load",function(){clearTimeout(i),n(!0)}),a.addEventListener("error",function(t){clearTimeout(i),console.error("linkExternalScript() ERROR",e,t),n(!1)}),a.src=encodeURI(e)})},window.mwdspace.MFA_Funraise_Widget.prototype.loadFile=function(e){this;return new Promise(function(t){"undefined"==typeof e&&(console.warn("loadFile() given empty url"),t(null)),"string"!=typeof e&&(console.warn("loadFile() given invalid url type:",typeof e,e),t(null));var n=encodeURI(e),a=new XMLHttpRequest,i=setTimeout(function(){console.log("linkExternalScript() No load after 5s",url),t(!1)},5e3);a.addEventListener("load",function(e){clearTimeout(i);var n=e.target.responseText||e.target.response||null;t(n)}),a.addEventListener("error",function(e){clearTimeout(i),console.error("loadFile() ERROR EVENT",n,e),t(null)}),a.open("get",n,!0),a.send()})},window.mwdspace.MFA_Funraise_Widget.prototype.getFontIconStyles=function(){var e=this;return new Promise(async t=>{var n=!1;return 4==e.options.fontAwesomeVersion?n=await e.linkExternalStylesheet(e.fontAwesome4Url):5==e.options.fontAwesomeVersion&&(n=await e.linkExternalStylesheet(e.fontAwesome5Url)),t(n)})},window.mwdspace.MFA_Funraise_Widget.prototype.prepareLabelOverride=function(){var e=this;return new Promise(async t=>{if(e.options.labelOverrideObject)console.log("Using label override object"),e.labelOverride=e.options.labelOverrideObject,t(!0);else if(e.options.labelOverrideFileUrl)try{console.log("Loading label override file",e.options.labelOverrideFileUrl);var n=await e.loadFile(e.options.labelOverrideFileUrl);if(n){var a=window.mwdspace.sharedUtils.safeJsonParse(n);a?(e.labelOverride=a,t(!0)):console.error("MFA_Funraise_Widget.prepareLabelOverride() - unable to parse text override data from file:",e.options.labelOverride)}else console.error("MFA_Funraise_Widget.prepareLabelOverride() - unable to load file for text override data:",e.options.labelOverride)}catch(e){console.log("prepareLabelOverride() caught error: ",e.message)}t(!1)})},window.mwdspace.MFA_Funraise_Widget.prototype.processLabelOverride=function(e,t){var n=this;if("object"!=typeof e||!e)return console.warn("MFA_Funraise_Widget.processLabelOverride() given invalid object",typeof e),!1;if("undefined"==typeof t)var t="";"string"!=typeof t&&(console.warn("Ignoring invalid string prefix value",t),t=""),t&&(t+=".");var a;for(var i in e)a=t+i,"string"==typeof e[i]?n.setElementText(a,e[i]):n.processLabelOverride(e[i],a)},window.mwdspace.MFA_Funraise_Widget.prototype.setElementText=function(e,t){this;if("undefined"==typeof e)var e="";if(!e)return void console.warn("setElementText() given empty labelId");var n,a="[data-label-id=\""+e+"\"]",r=document.querySelectorAll(a);if(r)for(var o=0;o<r.length;o++)n=(r[o].tagName+"").toLowerCase(),"input"===n?r[o].setAttribute("placeholder",t):"label"===n||"span"===n||"div"===n||"option"===n||"h1"===n||"h2"===n||"h3"===n||"h4"===n||"h5"===n||"h6"===n||"p"===n||"li"===n?r[o].innerHTML=t:console.warn("setElementText(): Ignoring tag",e,n);else console.warn("REPLACE labelId not found",e)}})();