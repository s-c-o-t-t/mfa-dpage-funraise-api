console.log("mwd-donate-widget.js v18.7.2"),window.mwdspace=window.mwdspace||{},window.mwdspace.MFA_Funraise_Widget=function(a){var b=this;if(b.options="object"==typeof a?a:{},b.targetElement={},b.isStarted=!1,b.codeVersion="1.0.0",b.mainStylesUrl=window.location.protocol+"//services.mwdagency.com/donate-widget/1.0.0/css/mwd-donate-widget.css",b.mainHtmlUrl=window.location.protocol+"//services.mwdagency.com/donate-widget/1.0.0/mwd-donate-widget.html",console.log("window.mwdspace.MFA_Funraise_Widget",b.codeVersion),b.options.loadingText||(b.options.loadingText="One moment..."),!b.options.element)return console.warn("Invalid options - No target element:",b.options),!1;var c=document.querySelectorAll(b.options.element);return c?void(b.targetElement=c[0]):(console.warn("Specified target element not found:",b.options.element),!1)},window.mwdspace.MFA_Funraise_Widget.prototype.start=async function(){var a=this;if(a.isStarted)return void console.warn("window.mwdspace.MFA_Funraise_Widget already started");a.isStarted=!0,console.log("window.mwdspace.MFA_Funraise_Widget start()",a.options),a.targetElement.innerHTML="";var b=a.linkExternalStylesheet("https://use.fontawesome.com/releases/v5.1.0/css/all.css"),c=a.options.styleSheets||a.mainStylesUrl,d=a.linkExternalStylesheet(c);a.linkExternalStylesheet("https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css"),await Promise.all([b,d]);var e,f,g=a.loadFile(a.mainHtmlUrl),h=a.linkExternalScript(window.location.protocol+"//services.mwdagency.com/donate-widget/1.0.0/js/shared-utils.js");if([e,f]=await Promise.all([g,h]),!e)return void console.error("MFA_Funraise_Widget.start() - unable to load base HTML");console.warn("");var i=document.createElement("div");if(i.id="mfaDonationWidgetContainer",i.style.opacity=0,a.targetElement.appendChild(i),i.innerHTML=e,setTimeout(function(){i.className="reveal"},1),a.options.textOverride){var j={};if("string"==typeof a.options.textOverride)try{var k=await a.loadFile(a.options.textOverride);if(!k)return void console.error("MFA_Funraise_Widget.start() - unable to load text override data from file:",a.options.textOverride);j=window.mwdspace.sharedUtils.safeJsonParse(k)}catch(a){console.log("Caught error: ",a.message)}else j=a.options.textOverride;a.processTextOverride(j)}var l,m=a.linkExternalScript("https://core.spreedly.com/iframe/iframe-v1.min.js"),n=a.linkExternalScript("https://code.jquery.com/jquery-3.3.1.min.js");await Promise.all([m,n]);var o=a.linkExternalScript("https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"),p=a.linkExternalScript(window.location.protocol+"//services.mwdagency.com/donate-widget/1.0.0/js/business-logic-layer.js"),q=a.linkExternalScript(window.location.protocol+"//services.mwdagency.com/donate-widget/1.0.0/js/transaction-system-layer.js");await Promise.all([p,q,o]),a.jquery=l?jQuery.noConflict():$||{},a.run()},window.mwdspace.MFA_Funraise_Widget.prototype.run=function(){function a(){switch(mwdspace.currentStepName){case"giftAmount":c("donorInfo");break;case"donorInfo":c("payment");}}function b(){switch(mwdspace.currentStepName){case"donorInfo":c("giftAmount");break;case"payment":c("donorInfo");}}function c(a){mwdspace.currentStepName="",a=window.mwdspace.sharedUtils.ensureString(a),a||(a=window.mwdspace.sharedUtils.getSessionValue("savedStepName"),!a&&(a="giftAmount")),s("div.giftFormContainer div.loadingDisplay").hide();for(var b,c=0;c<v.length;c++)b=v[c].getAttribute("data-step-name"),b==a?(0==c?w.hide():(s("div.giftFormHeaderContainer").show(),w.fadeIn(888)),s(v[c]).fadeIn(666,function(){q(s("div.giftFormContainer"))}),mwdspace.currentStepName=b,window.mwdspace.sharedUtils.setSessionValue("savedStepName",b)):s(v[c]).hide()}function d(a){if(console.log(">>> recordGiftAmount()"),"undefined"==typeof a)var a=0;t.amount=0;try{a=parseFloat(a),t.amount=a||0;var b=t.amount.toFixed(2).split(".");console.log("displayAmount",b),s("div.giftFormContainer div.amountDisplay span.displayWholeAmount").text(b[0]),s("div.giftFormContainer div.amountDisplay span.displaySubAmount").text("."+b[1])}catch(a){console.log("recordGiftAmount() caught error: ",a.message)}}function e(){for(var a,b=A.val(),c="???",d=0;d<window.mwdspace.validCurrencyList.length;d++)if(a=window.mwdspace.validCurrencyList[d],a.code==b&&a.symbol){c=a.symbol;break}s("div.giftFormContainer span.currencySymbol").html(c)}function f(a){var b=null;try{a.code&&(b=document.createElement("option"),b.setAttribute("value",a.code),b.innerText=a.code+" "+(a.name||""))}catch(b){console.error("Unable to build the option element for currency:",a)}return b}function g(a){var b=null;try{a.code&&(b=document.createElement("option"),b.setAttribute("value",a.code),b.innerText=a.description||"")}catch(b){console.error("Unable to build the option element for method:",a)}return b}function h(a){var b=null;try{if(a.code){b=document.createElement("div"),s(b).addClass("giftOption fixed");var c=document.createElement("label");s(c).addClass("giftOption"),c.innerText=a.name||"Unknown",b.appendChild(c);var d=document.createElement("input");d.setAttribute("type","radio"),d.setAttribute("name","giftFrequency"),d.setAttribute("value",a.code),c.appendChild(d)}}catch(b){console.error("Error building the button for frequency:",a,b)}return b}function j(){if("undefined"==typeof a)var a={};"object"!=typeof a&&(a={},console.warn("prepareRegionInput(): ignoring invalid option object",a));try{for(var b,c=s("div.giftFormContainer select[name=\"donorCountry\"]").val(),d=0;d<window.mwdspace.validCountryList.length;d++)if(b=window.mwdspace.validCountryList[d],(c==b.code||c==b.name)&&b.regions&&l(b.regions))return!0}catch(a){console.error("Unable to prepare the region input method",a)}k()}function k(){y.val("").show(),x.hide()}function l(a){if(y.hide(),x.show(),"undefined"==typeof a)return console.warn("buildRegionSelect(): no regions object",a),!1;if("object"!=typeof a||1>a.length)return console.warn("buildRegionSelect(): invalid regions object",a),!1;try{if(1!==x.length)return console.error("Unable to identify the region select dropdown"),!1;var b,c,d=0;x.empty(),b=m("State/Region..."),x.append(b);for(var e=0;e<a.length;e++)c=a[e],b=m(c.name),b?(x.append(b),d++):console.warn("Unable to add region:",c);if(0<d)return!0}catch(a){console.error("Unable to build the region select dropdown",a)}return!1}function m(a){try{if("string"==typeof a&&a.trim()){var b=null;return b=document.createElement("option"),b.innerText=a,b}}catch(a){console.error("Unable to build the option element for region:",region)}return null}function n(a){var b=null;try{a.code&&(b=document.createElement("option"),b.setAttribute("value",a.code),b.innerText=a.name)}catch(b){console.error("Unable to build the option element for country:",a)}return b}function i(a,b){var c=null;try{if("number"!=typeof a&&"string"!=typeof a&&!a)console.error("Invalid month given:",a);else{if("undefined"==typeof b)var b=a;try{a=window.mwdspace.sharedUtils.ensureString(a),a=a.padStart(2,"0")}catch(a){}c=document.createElement("option"),c.setAttribute("value",b),c.innerText=a}}catch(b){console.error("Unable to build the option element for month:",a)}return c}function o(a,b){var c=null;try{if("number"!=typeof a&&"string"!=typeof a&&!a)console.error("Invalid year given:",a);else{if("undefined"==typeof b)var b=a;c=document.createElement("option"),c.setAttribute("value",b),c.innerText=a}}catch(b){console.error("Unable to build the option element for year:",a)}return c}function p(a){for(var b=0;b<a.length;b++);}function q(a){a=s(a);var b=s(window).scrollTop(),c=s(window).height(),d=b,e=(a.outerHeight()-a.innerHeight())/2;e=0>=e?4:e;var f=a.offset().top+e,g=f+a.innerHeight();return a.innerHeight()>c?void s("html,body").animate({scrollTop:f,easing:"ease"},999):d>f?void s("html,body").animate({scrollTop:f,easing:"ease"},999):void(d+c<g&&s("html,body").animate({scrollTop:g-c+e,easing:"ease"},999))}var r=this;"function"!=typeof r.jquery&&(console.error("jQuery (thisWidget.jquery) not found"),exit());var s=r.jquery;console.log("MFA_Funraise_Widget using jQuery version",s.fn.jquery),window.mwdspace.userInputData={};var t=window.mwdspace.userInputData;r.defaultGiftList=[25,50,75,100];var u=r.options.paymentTokenizerId||"ODBm2idmYFT3pBge5qxRBjQaWH9",v=s("div.giftFormContainer section.step"),w=s("div.giftFormContainer button.goPreviousStep"),x=s("div.giftFormContainer select[name=\"donorRegion\"]"),y=s("div.giftFormContainer input[name=\"donorRegion\"]"),z=s("div.giftFormContainer div.giftOption input"),A=s("div.giftFormContainer select[name=\"giftCurrency\"]");"object"==typeof Spreedly?(Spreedly.on("ready",function(){console.log("\n\nSPREEDLY READY",Spreedly),Spreedly.setPlaceholder("number","Card"),Spreedly.setFieldType("number","text"),Spreedly.setNumberFormat("prettyFormat"),Spreedly.setLabel("number","Payment card number"),Spreedly.setPlaceholder("cvv","cvv"),Spreedly.setLabel("cvv","Payment card 3-digit verification code"),Spreedly.setValue("number","4111111111111111"),Spreedly.setValue("cvv","123")}),Spreedly.on("paymentMethod",function(a){console.log("\n\nSPREEDLY PAYMENT TOKENIZED",a)}),Spreedly.on("errors",function(a){console.log("\n\nSPREEDLY REPORTS ERRORS:");for(var b,c=0;c<a.length;c++)b=a[c],console.log(b)})):console.warn("Skipping Spreedly setup"),function(a){if("undefined"==typeof a)var a={};"object"!=typeof a&&(a={},console.warn("buildCurrencySelect(): ignoring invalid option object",a));var b="string"==typeof a.default?a.default:"USD";try{if(!window.mwdspace.validCurrencyList)throw new Error("List of valid currencies not found");var c=A;if(1!==c.length)throw new Error("Unable to identify the currency select dropdown");for(var d,e,g,h=0;h<window.mwdspace.validCurrencyList.length;h++)g=!0,e=window.mwdspace.validCurrencyList[h],a.filterList&&(g=p(a.filterList,e.code)),g&&(d=f(e),d?c.append(d):console.warn("Unable to add currency:",e));c.val(b).trigger("change")}catch(a){console.error("Unable to build the currency select dropdown",a)}}(),function(){try{if(!window.mwdspace.validPayMethodList)throw new Error("List of valid payment methods not found");var a=s("div.giftFormContainer select[name=\"payMethod\"]");if(1!==a.length)throw new Error("Unable to identify the payment method select dropdown");for(var b,c=0;c<window.mwdspace.validPayMethodList.length;c++)b=g(window.mwdspace.validPayMethodList[c]),b?a.append(b):console.warn("Unable to add payment method:",window.mwdspace.validPayMethodList[c])}catch(a){console.error("Unable to build the payment method select dropdown",a)}}(),function(){try{if(!window.mwdspace.validFrequencyList||1>window.mwdspace.validFrequencyList.length)throw new Error("Invalid list of frequencies given");var a=s("div.giftFormContainer div.giftFrequencyContainer");if(1!==a.length)throw new Error("Unable to identify the frequency select dropdown");a.find("div.giftOption").remove();for(var b,c=0;c<window.mwdspace.validFrequencyList.length;c++)b=h(window.mwdspace.validFrequencyList[c]),b?a.append(b):console.warn("Unable to add frequency:",window.mwdspace.validFrequencyList[c])}catch(a){console.error("Unable to build the frequency buttons",a)}}(),function(a){if("undefined"==typeof a)var a={};"object"!=typeof a&&(a={},console.warn("buildCountrySelect(): ignoring invalid option object",a));var b="string"==typeof a.default?a.default:"US";try{if(!window.mwdspace.validCountryList)throw new Error("List of valid countries not found");var c=s("div.giftFormContainer select[name=\"donorCountry\"]");if(c.on("change",j),1!==c.length)throw new Error("Unable to identify the country select dropdown");for(var d,e,f,g=0;g<window.mwdspace.validCountryList.length;g++)f=!0,e=window.mwdspace.validCountryList[g],a.filterList&&(f=p(a.filterList,e.code)),f&&(d=n(e),d?c.append(d):console.warn("Unable to add country:",e));c.val(b).trigger("change")}catch(a){console.error("Unable to build the country select dropdown",a)}}(),function(){try{var a=s("div.giftFormContainer select[name=\"payCardExpireMonth\"]");if(1!==a.length)throw new Error("Unable to identify the card expire month select dropdown");var b=i("Month","");a.append(b);for(var c=1;12>=c;c++)b=i(c),b?a.append(b):console.warn("Unable to add card expire month:",c)}catch(a){console.error("Unable to build the card expire month select dropdown",a)}}(),function(){try{var a=new Date;a.setDate(a.getDate()-7);var b=a.getFullYear(),c=s("div.giftFormContainer select[name=\"payCardExpireYear\"]");if(1!==c.length)throw new Error("Unable to identify the card expire year select dropdown");var d=o("Year","");c.append(d);for(var e=b;e<b+15;e++)d=o(e),d?c.append(d):console.warn("Unable to add card expire year:",e)}catch(a){console.error("Unable to build the card expire year select dropdown",a)}}(),function(){s("select[name=\"donorMatchCompany\"]").select2({minimumInputLength:3,delay:400,placeholder:"Enter your company name",ajax:{url:"https://platform.funraise.io/api/v1/ddcompanies",data:function(a){var b={q:a.term};return b},processResults:function(a){var b={results:[]};if("object"==typeof a&&a.length)for(var c=0;c<a.length;c++)a[c].name&&b.results.push({id:c,text:a[c].name});return b}}}),setInterval(function(){s(".select2-container").css("width","100%")},999)}(),c(),"object"==typeof Spreedly&&Spreedly.init(u,{numberEl:"cardNumberTarget",cvvEl:"cardCvvTarget"}),function(){z.on("change focus keyup",function(a){console.log("jqGiftAmountFields",a.type),z.removeClass("selected");var b=s(a.target);b.addClass("selected");var c=parseFloat(b.val())||0;d(c),"change"==a.type&&s("div.giftFormHeaderContainer").slideDown(666,function(){q(s("div.giftFormContainer"))})}),A.on("change",function(){e()}).trigger("change")}(),document.addEventListener("click",function(c){var d=s(c.target).closest("button, clickTarget");if(d)if(d.hasClass("processDonation")){if(window.mwdspace.donationInProgress)return alert("There's already a donation processing."),!1;var e=c.target.getAttribute("data-working");e&&s(c.target).addClass("blocked").html(e);if("object"==typeof Spreedly){var f={first_name:s("div.giftFormContainer input[name=\"donorFirstname\"]").val(),last_name:s("div.giftFormContainer input[name=\"donorLastname\"]").val(),month:s("div.giftFormContainer select[name=\"payCardExpireMonth\"]").val(),year:s("div.giftFormContainer select[name=\"payCardExpireYear\"]").val(),email:s("div.giftFormContainer input[name=\"donorEmail\"]").val(),zip:s("div.giftFormContainer input[name=\"donorPostCode\"]").val()};console.log("tokenOptions",f),Spreedly.tokenizeCreditCard(f)}window.mwdspace.transactionLayer.startDonation({amount:6.66},function(a){console.log("SUCCESS FUNCTION",a);var b=c.target.getAttribute("data-success");s(c.target).removeClass("blocked").html(b)},function(a){console.log("FAIL FUNCTION",a);var b=c.target.getAttribute("data-error");s(c.target).removeClass("blocked").addClass("error").html(b)})}else d.hasClass("goNextStep")?d.hasClass("invalid")?(d.addClass("showInvalid"),setTimeout(function(){d.removeClass("showInvalid")},3333)):a():d.hasClass("goPreviousStep")&&b()})},window.mwdspace.MFA_Funraise_Widget.prototype.linkExternalStylesheet=function(a){var b=this;return new Promise(function(c){var d=document.createElement("link");b.targetElement.appendChild(d),d.rel="stylesheet",d.type="text/css";var e=setTimeout(function(){console.log("linkExternalStylesheet() No result after 2s",a),c(!1)},2e3);d.addEventListener("load",function(){clearTimeout(e),c(!0)}),d.addEventListener("error",function(b){console.error("linkExternalStylesheet() ERROR EVENT",a,b),c(!1)}),d.addEventListener("abort",function(b){console.warn("linkExternalStylesheet() ABORT EVENT",a,b),c(!1)}),d.href=encodeURI(a)})},window.mwdspace.MFA_Funraise_Widget.prototype.linkExternalScript=function(a){var b=this;return new Promise(function(c){var d=document.createElement("script");b.targetElement.appendChild(d);var e=setTimeout(function(){console.log("linkExternalScript() No result after 2s",a),c(!1)},2e3);d.addEventListener("load",function(){clearTimeout(e),c(!0)}),d.addEventListener("error",function(b){clearTimeout(e),console.error("linkExternalScript() ERROR",a,b),c(!1)}),d.addEventListener("abort",function(b){clearTimeout(e),console.warn("linkExternalScript() ABORTED",a,b),c(!1)}),d.src=encodeURI(a)})},window.mwdspace.MFA_Funraise_Widget.prototype.loadFile=function(a){this;return new Promise(function(b){"undefined"==typeof a&&(console.warn("loadFile() given empty url"),b(null)),"string"!=typeof a&&(console.warn("loadFile() given invalid url type:",typeof a,a),b(null));var c=encodeURI(a),d=new XMLHttpRequest;d.addEventListener("load",function(a){var c=a.target.responseText||a.target.response||null;b(c)}),d.addEventListener("error",function(a){console.error("loadFile() ERROR EVENT",c,a),b(null)}),d.addEventListener("abort",function(a){console.warn("loadFile() ABORT EVENT",c,a),b(null)}),d.open("get",c,!0),d.send()})},window.mwdspace.MFA_Funraise_Widget.prototype.processTextOverride=function(a){var b=this;if("undefined"==typeof a)var a={};if("object"!=typeof a||!a)return console.log("MFA_Funraise_Widget.processTextOverride() given invalid object",typeof a),!1;console.warn("processTextOverride() input",a);var c;for(var d in a)if("object"==typeof a[d])for(var e in a[d])c=d+"."+e,b.setElementText(c,a[d][e])},window.mwdspace.MFA_Funraise_Widget.prototype.setElementText=function(a,b){this;if("undefined"==typeof a)var a="";if(!a)return void console.warn("setElementText() given empty labelId");var c,d="[data-label-id=\""+a+"\"]",e=document.querySelectorAll(d);if(e)for(var f=0;f<e.length;f++)c=(e[f].tagName+"").toLowerCase(),"input"===c?e[f].setAttribute("placeholder",b):"label"===c||"span"===c||"h1"===c||"h2"===c||"h3"===c||"h4"===c||"h5"===c||"h6"===c||"p"===c?e[f].innerHTML=b:console.warn("setElementText(): Ignoring tag",a,c)};