function safeJsonParse(t){try{return JSON.parse(t)}catch(e){console.error("safeJsonParse(): Caught error: "+e.message),console.log("safeJsonParse() INPUT:",t)}return null}function safeJsonString(t){var e=null;try{e=JSON.stringify(t)}catch(e){console.error("safeJsonString(): Caught error: "+e.message),console.log("safeJsonString() INPUT:",t)}return e}function stringEquals(e,t){return ensureString(e)==ensureString(t)}function stringEqualsIgnore(e,t){return ensureString(e).toLowerCase()==ensureString(t).toLowerCase()}function ensureString(e){if(null!=e)try{return String(e)}catch(e){console.warn("ensureString() caught error:",e)}return""}function isEmpty(e){return void 0===e||(!e||("string"==typeof e&&""==e.trim()||("object"==typeof e&&void 0!==e.length&&e.length<1||"object"==typeof e&&0===Object.keys(e).length&&e.constructor===Object)))}function setSessionValue(t,o){if(void 0===o)o="";"undefined"==o&&console.log('getSessionValue() STRING = "UNDEFINED"'),void 0===o&&console.log("getSessionValue() IS UNDEFINED");try{sessionStorage.setItem(t,o)}catch(e){console.warn("setSessionValue(): Unable to use session storage."),createCookie(t,o,0)}}function getSessionValue(t){var o=null;try{o=sessionStorage.getItem(t)}catch(e){console.warn("getSessionValue(): Unable to use session storage."),o=readCookie(t)}return o}function removeSessionValue(t){try{value=sessionStorage.removeItem(t)}catch(e){console.warn("removeLocalValue(): Unable to use session storage."),createCookie(t,"",-1)}return value}function setLocalValue(t,o){if(void 0===o)o="";"undefined"==o&&console.log('getSessionValue() STRING = "UNDEFINED"'),void 0===o&&console.log("getSessionValue() IS UNDEFINED");try{localStorage.setItem(t,o)}catch(e){console.warn("setLocalValue(): Unable to use local storage."),createCookie(t,o,365)}}function getLocalValue(t){var o=null;try{o=localStorage.getItem(t)}catch(e){console.warn("getLocalValue(): Unable to use local storage."),o=readCookie(t)}return o}function removeLocalValue(t){try{value=localStorage.removeItem(t)}catch(e){console.warn("removeLocalValue(): Unable to use local storage."),createCookie(t,"",-1)}return value}function createCookie(e,t,o){var n="";if(o){var r=new Date;r.setTime(r.getTime()+24*o*60*60*1e3),n="; expires="+r.toGMTString()}document.cookie=e+"="+t+n+"; path=/"}function readCookie(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var r=o[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return!1}function getUrlParameter(e,t){if(void 0===t)t=!0;var o=ensureString(e);if(isEmpty(o))return console.warn("getUrlParameter() given empty input"),"";"object"!=typeof window.mwdspace.urlParameters&&makeUrlParameterList();var n=new RegExp(o,t?"i":"");for(parameterKey in window.mwdspace.urlParameters)if(parameterKey.match(n))return window.mwdspace.urlParameters[parameterKey];return""}function makeUrlParameterList(){window.mwdspace.urlParameters={};for(var e,t,o=window.location.search.split(/[\?&]/),n=0;n<o.length;n++)isEmpty(o[n])||(t=ensureString((e=o[n].split("="))[0]).replace("+"," "),isEmpty(t=decodeURIComponent(t))||(window.mwdspace.urlParameters[t]=decodeURIComponent(e[1])))}console.log("shared-utils.js v18.4.19"),window.mwdspace=window.mwdspace||{},console.log("business-logic-layer.js v18.4.19"),console.log("transaction-system-layer.js v18.4.19");var apiConstants={baseUrl:"http://localhost:8080/funraise/api/v2/"},requestTimeoutSeconds=20;function startDonation(e,o,n){if(console.log(">>>> startDonation()"),void 0===e)e={};window.mwdspace.donationInProgress=!0;var t=e.data||{},r={method:"post",url:apiConstants.baseUrl+"donation",sendData:t,verbose:!0};try{sendXhrRequest(r,function(e){if(console.log("response INITIAL",typeof e,e),!e.json||!e.json.id)return console.error('startDonation(): Invalid response, no "id":'),console.log(e),n(e);var t=e.json.id;window.mwdspace.donationStartTime=new Date,setSessionValue("donationId",t),setSessionValue("donationStartTime",window.mwdspace.donationStartTime.toUTCString()),completeDonation(t,1e3,o,n)},n)}catch(e){console.error("startDonation CAUGHT ERROR",e),n({})}}function completeDonation(t,o,n,r){if(void 0===t)t="";if(void 0===o)o=0;t||(console.error("completeDonation(): Empty id given"),r({})),o<=0&&(o=500),console.log(">>>> completeDonation() (",typeof t,")",t,o);var e=(new Date).getTime()-window.mwdspace.donationStartTime.getTime();if(console.log("elapsedMilliseconds",e),1e3*requestTimeoutSeconds<e)return console.error("completeDonation(): request timeout reached, calling fail function."),r({});setTimeout(function(){console.log("completeDonation() RUNNING"),sendXhrRequest({method:"get",url:apiConstants.baseUrl+"donation/"+t,verbose:!0},function(e){return console.log("response POLL",typeof e,e),204==e.status?(console.log("STATUS 204 RECEIVED, DONATION STILL PROCESSING"),completeDonation(t,o*=1.25,n,r)):e.json?(removeSessionValue("donationId"),removeSessionValue("donationStartTime"),n(e)):(console.error("completeDonation(): Invalid response follows:"),console.warn(e),r(e))},r)},o)}function sendXhrRequest(e,t,o){if(void 0===e)e={};var n=e.method||"post",r=e.url||"",s=(e.sendData,!0===e.verbose),a=getContentType(e.sendContentType||null),i=getContentType(e.acceptContentType||null),c="function"==typeof e.progressFunction&&e.progressFunction,l=new XMLHttpRequest;l.addEventListener("load",function(){if(200<=this.status&&this.status<=299){var e={status:this.status,text:this.responseText,json:{}};this.responseText&&(e.json=safeJsonParse(this.responseText)||{}),e.json||204==this.status?t(e):(console.error("INVALID RESPONSE FROM SERVER. RESPONSE FOLLOWS:"),console.log(this.responseText),console.warn("There may be a problem on the server.",{isError:!0}),t({}))}else console.log(">>> sendXhrRequest() raw response",this.responseText),console.warn("The server has reported an issue.",{isError:!0}),t({})}),l.addEventListener("error",function(e){console.log("event.status",e.status),console.warn("sendXhrRequest(): request failed",this),console.log(e),o(this)}),l.addEventListener("abort",function(e){console.warn("sendXhrRequest(): request canceled",this),console.log(e),o(this)}),c&&l.addEventListener("progress",function(e){e.percentComplete=e.lengthComputable?e.loaded/e.total*100:null,c(e)}),s&&console.log(">>> sendXhrRequest() sending to",r),l.open(n,r,!0),l.setRequestHeader("Content-Type",a),l.setRequestHeader("Accept",i);l.send();s&&console.log(">>> sendXhrRequest() sent")}function getContentType(e){switch(e=ensureString(e).toLowerCase()){case"url":case"urlencoded":return"application/x-www-form-urlencoded";case"text":return"text/plain";default:return"application/json"}}window.mwdspace.donationInProgress=!1,window.mwdspace.donationStartTime,window.mwdspace.currencyList=[{code:"USD",name:"U.S. Dollar",symbol:"$"},{code:"CAD",name:"Canadian Dollar",symbol:"C$"},{code:"MXN",name:"Mexican Peso",symbol:"MEX"},{code:"BRL",name:"Brazilian Real",symbol:"R$"},{code:"INR",name:"Indian Rupee",symbol:"&#8360;"}],window.mwdspace.payMethodList=[{code:"card",name:"Card",description:"Donate With Card",minimumAmount:5,maximumAmount:2e4,subtypes:[{code:"card",name:"&#128179; Donate With Card"}],frequencies:[{code:"single",name:"One-Time"},{code:"monthly",name:"Monthly"}]},{code:"bitcoin",name:"Bitcoin",description:"&#8383; Donate With Bitcoin",minimumAmount:5,maximumAmount:2e4,frequencies:[{code:"single",name:"One-Time"}]}],console.log("user-interface-layer.js v18.4.19");var stepList=document.querySelectorAll("section.step"),domMainBackButton=document.querySelector("button.goPreviousStep");function showStep(t){var o;(t=ensureString(t))||(t="giftAmount"),stepList.forEach(function(e){(o=e.getAttribute("data-step-name"))==t?("giftAmount"==o?$(domMainBackButton).hide():$(domMainBackButton).fadeIn(888),$(e).fadeIn(666)):$(e).hide()})}function buildCurrencySelect(){try{if(!window.mwdspace.currencyList)throw new Error("List of valid currencies not found");var t,o=document.querySelector("form.mainGiftForm select[name=giftCurrency]");if(!o)throw new Error("Unable to identify the currency select dropdown");window.mwdspace.currencyList.forEach(function(e){(t=buildCurrencyOption(e))?o.appendChild(t):console.warn("Unable to add currency:",e)})}catch(e){console.error("Unable to build the currency select dropdown",e)}}function buildCurrencyOption(t){var e=null;try{t.code&&((e=document.createElement("option")).setAttribute("value",t.code),e.innerText=t.code+" "+(t.name||""))}catch(e){console.error("Unable to build the option element for currency:",t)}return e}function buildPayMethodSelect(){try{if(!window.mwdspace.payMethodList)throw new Error("List of valid payment methods not found");var t,o=document.querySelector("form.mainGiftForm select[name=payMethod]");if(!o)throw new Error("Unable to identify the payment method select dropdown");window.mwdspace.payMethodList.forEach(function(e){(t=buildPayMethodOption(e))?o.appendChild(t):console.warn("Unable to add payment method:",e)})}catch(e){console.error("Unable to build the payment method select dropdown",e)}}function buildPayMethodOption(e){var t=null;try{e.code&&((t=document.createElement("option")).setAttribute("value",e.code),t.innerText=e.description||"")}catch(e){console.error("Unable to build the option element for currency:",currency)}return t}function buildFrequencyButtons(e){console.log("frequencyList",e);try{if(!e)throw new Error("Invalid list of frequencies given");var t,o=document.querySelector("form.mainGiftForm div.giftFrequencyContainer");if(!o)throw new Error("Unable to identify the frequency select dropdown");o.querySelectorAll("div.giftOption").forEach(function(e){e.remove()}),e.forEach(function(e){console.log("PROCESSING",e),(t=buildFrequencyButton(e))?o.append(t):console.warn("Unable to add frequency:",e)})}catch(e){console.error("Unable to build the frequency buttons",e)}}function buildFrequencyButton(t){console.log("buildFrequencyButton(frequency)",t);var e=null;try{if(t.code){(e=document.createElement("div")).classList.add("giftOption"),e.classList.add("fixed");var o=document.createElement("label");o.classList.add("giftOption"),o.innerText=t.name||"Unknown",e.appendChild(o);var n=document.createElement("input");n.setAttribute("type","radio"),n.setAttribute("name","giftFrequency"),n.setAttribute("value",t.code),o.appendChild(n)}}catch(e){console.error("Error building the button for frequency:",t,e)}return e}buildCurrencySelect(),buildPayMethodSelect(),buildFrequencyButtons(window.mwdspace.payMethodList[0].frequencies),showStep(),$("input[type=radio]").change(function(){$(this).closest("section").find("input[type=radio]").closest("label").removeClass("selected"),$(this).closest("label").addClass("selected"),$("div.giftFormHeaderContainer").slideDown(666)}),document.addEventListener("click",function(o){console.log("click",o.target.tagName,o.target.className);var e=$(o.target).closest("button, .clickTarget");if(e)if(e.hasClass("processDonation")){if(window.mwdspace.donationInProgress)return alert("There's already a donation processing."),!1;var t=o.target.getAttribute("data-working");t&&(o.target.classList.add("blocked"),o.target.innerHTML=t);startDonation({amount:6.66},function(e){console.log("SUCCESS FUNCTION",e);var t=o.target.getAttribute("data-success");o.target.classList.remove("blocked"),o.target.innerHTML=t},function(e){console.log("FAIL FUNCTION",e);var t=o.target.getAttribute("data-error");o.target.classList.remove("blocked"),o.target.classList.add("error"),o.target.innerHTML=t})}else e.hasClass("goNextStep")&&showStep("payment")});