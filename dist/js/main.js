function safeJsonParse(t){try{return JSON.parse(t)}catch(e){console.error("safeJsonParse(): Caught error: "+e.message),console.log("safeJsonParse() INPUT:",t)}return null}function safeJsonString(t){var e=null;try{e=JSON.stringify(t)}catch(e){console.error("safeJsonString(): Caught error: "+e.message),console.log("safeJsonString() INPUT:",t)}return e}function stringEquals(e,t){return ensureString(e)==ensureString(t)}function stringEqualsIgnore(e,t){return ensureString(e).toLowerCase()==ensureString(t).toLowerCase()}function ensureString(e){if(null!=e)try{return String(e)}catch(e){console.warn("ensureString() caught error:",e)}return""}function isEmpty(e){return void 0===e||(!e||("string"==typeof e&&""==e.trim()||("object"==typeof e&&void 0!==e.length&&e.length<1||"object"==typeof e&&0===Object.keys(e).length&&e.constructor===Object)))}function setSessionValue(t,o){if(void 0===o)o="";"undefined"==o&&console.log('getSessionValue() STRING = "UNDEFINED"'),void 0===o&&console.log("getSessionValue() IS UNDEFINED");try{sessionStorage.setItem(t,o)}catch(e){console.warn("setSessionValue(): Unable to use session storage."),createCookie(t,o,0)}}function getSessionValue(t){var o=null;try{o=sessionStorage.getItem(t)}catch(e){console.warn("getSessionValue(): Unable to use session storage."),o=readCookie(t)}return o}function removeSessionValue(t){try{value=sessionStorage.removeItem(t)}catch(e){console.warn("removeLocalValue(): Unable to use session storage."),createCookie(t,"",-1)}return value}function setLocalValue(t,o){if(void 0===o)o="";"undefined"==o&&console.log('getSessionValue() STRING = "UNDEFINED"'),void 0===o&&console.log("getSessionValue() IS UNDEFINED");try{localStorage.setItem(t,o)}catch(e){console.warn("setLocalValue(): Unable to use local storage."),createCookie(t,o,365)}}function getLocalValue(t){var o=null;try{o=localStorage.getItem(t)}catch(e){console.warn("getLocalValue(): Unable to use local storage."),o=readCookie(t)}return o}function removeLocalValue(t){try{value=localStorage.removeItem(t)}catch(e){console.warn("removeLocalValue(): Unable to use local storage."),createCookie(t,"",-1)}return value}function createCookie(e,t,o){var n="";if(o){var s=new Date;s.setTime(s.getTime()+24*o*60*60*1e3),n="; expires="+s.toGMTString()}document.cookie=e+"="+t+n+"; path=/"}function readCookie(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var s=o[n];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return!1}function getUrlParameter(e,t){if(void 0===t)t=!0;var o=ensureString(e);if(isEmpty(o))return console.warn("getUrlParameter() given empty input"),"";"object"!=typeof window.mwdspace.urlParameters&&makeUrlParameterList();var n=new RegExp(o,t?"i":"");for(parameterKey in window.mwdspace.urlParameters)if(parameterKey.match(n))return window.mwdspace.urlParameters[parameterKey];return""}function makeUrlParameterList(){window.mwdspace.urlParameters={};for(var e,t,o=window.location.search.split(/[\?&]/),n=0;n<o.length;n++)isEmpty(o[n])||(t=(t=ensureString((e=o[n].split("="))[0])).replace("+"," "),isEmpty(t=decodeURIComponent(t))||isEmpty(t)||(window.mwdspace.urlParameters[t]=decodeURIComponent(e[1])))}console.log("shared-utils.js v18.4.19"),window.mwdspace=window.mwdspace||{},console.log("business-logic-layer.js v18.4.19"),console.log("transaction-system-layer.js v18.4.19");var donationStartTime,apiConstants={baseUrl:"http://localhost:8080/funraise/api/v2/"},requestTimeoutSeconds=20;function startDonation(e,o,n){if(console.log("typeofs at startDonation:",typeof o,typeof n),console.log(">>>> startDonation()"),void 0===e)e={};var t=e.data||{},s={method:"post",url:apiConstants.baseUrl+"donation",sendData:t,verbose:!0};try{sendXhrRequest(s,function(e){if(console.log("response INITIAL",typeof e,e),!e.json||!e.json.id)return console.error('startDonation(): Invalid response, no "id":'),console.log(e),n(e);var t=e.json.id;donationStartTime=new Date,setSessionValue("donationInProgress",t),setSessionValue("donationStartTime",donationStartTime.toUTCString()),console.log("typeofs: before call to competeDonation",typeof o,typeof n),completeDonation(t,1e3,o,n)},n)}catch(e){console.error("startDonation CAUGHT ERROR",e),n({})}}function completeDonation(t,o,n,s){if(console.log("typeofs at completeDonation:",typeof n,typeof s),void 0===t)t="";if(void 0===o)o=0;t||(console.error("completeDonation(): Empty id given"),s({})),o<=0&&(o=500),console.log(">>>> completeDonation() (",typeof t,")",t,o);var e=(new Date).getTime()-donationStartTime.getTime();if(console.log("elapsedMilliseconds",e),1e3*requestTimeoutSeconds<e)return console.error("completeDonation(): request timeout reached, calling fail function."),s({});console.log("completeDonation() WAITING..."),console.log("typeofs:",typeof n,typeof s),setTimeout(function(){console.log("completeDonation() RUNNING"),console.log("typeofs:",typeof n,typeof s),sendXhrRequest({method:"get",url:apiConstants.baseUrl+"donation/"+t,verbose:!0},function(e){return console.log("response POLL",typeof e,e),204==e.status?(console.log("STATUS 204 RECEIVED, DONATION STILL PROCESSING"),completeDonation(t,o*=1.25,n,s)):e.json?(removeSessionValue("donationInProgress"),removeSessionValue("donationStartTime"),n(e)):(console.error("completeDonation(): Invalid response follows:"),console.warn(e),s(e))},s)},o)}function sendXhrRequest(e,t,o){if(void 0===e)e={};var n=e.method||"post",s=e.url||"",r=(e.sendData,!0===e.verbose),a=getContentType(e.sendContentType||null),i=getContentType(e.acceptContentType||null),l="function"==typeof e.progressFunction&&e.progressFunction,c=new XMLHttpRequest;c.addEventListener("load",function(){if(200<=this.status&&this.status<=299){var e={status:this.status,text:this.responseText,json:{}};this.responseText&&(e.json=safeJsonParse(this.responseText)||{}),e.json||204==this.status?t(e):(console.error("INVALID RESPONSE FROM SERVER. RESPONSE FOLLOWS:"),console.log(this.responseText),console.warn("There appears to be a problem on the server.",{isError:!0}),t({}))}else console.log(">>> sendXhrRequest() raw response",this.responseText),console.warn("The server has reported an issue.",{isError:!0}),t({})}),c.addEventListener("error",function(e){console.log("event.status",e.status),console.warn("sendXhrRequest(): request failed",this),console.log(e),o(this)}),c.addEventListener("abort",function(e){console.warn("sendXhrRequest(): request canceled",this),console.log(e),o(this)}),l&&c.addEventListener("progress",function(e){e.percentComplete=e.lengthComputable?e.loaded/e.total*100:null,l(e)}),r&&console.log(">>> sendXhrRequest() sending to",s),c.open(n,s,!0),c.setRequestHeader("Content-Type",a),c.setRequestHeader("Accept",i),c.send(),r&&console.log(">>> sendXhrRequest() sent")}function getContentType(e){switch(e=ensureString(e).toLowerCase()){case"url":case"urlencoded":return"application/x-www-form-urlencoded";case"text":return"text/plain";default:return"application/json"}}console.log("user-interface-layer.js v18.4.19");var stepList=document.querySelectorAll("section.step"),domMainBackButton=document.querySelector("button.goPreviousStep");function showStep(t){var o;stepList.forEach(function(e){(o=e.getAttribute("data-step-name"))==t?("giftAmount"==o?$(domMainBackButton).hide():$(domMainBackButton).show(),$(e).fadeIn(666)):$(e).hide()})}showStep("giftAmount"),$("input[type=radio]").change(function(){$("div.giftFormHeaderContainer").slideDown(666)}),document.addEventListener("click",function(o){console.log("CLICK ON",o.target.tagName,o.target.className);var e=$(o.target).closest("button, .clickTarget");if(e)if(e.hasClass("processDonation")){var t=o.target.getAttribute("data-working");t&&(o.target.classList.add("blocked"),o.target.innerHTML=t);startDonation({amount:6.66},function(e){console.log("SUCCESS FUNCTION",e);var t=o.target.getAttribute("data-success");o.target.classList.remove("blocked"),o.target.innerHTML=t,alert(e.text)},function(e){console.log("FAIL FUNCTION",e);var t=o.target.getAttribute("data-error");o.target.classList.remove("blocked"),o.target.classList.add("error"),o.target.innerHTML=t})}else e.hasClass("goNextStep")&&showStep("payment")});