function safeJsonParse(o){try{return JSON.parse(o)}catch(e){console.error("safeJsonParse(): Caught error: "+e.message),console.log("safeJsonParse() INPUT:",o)}return null}function safeJsonString(o){var e=null;try{e=JSON.stringify(o)}catch(e){console.error("safeJsonString(): Caught error: "+e.message),console.log("safeJsonString() INPUT:",o)}return e}function stringEquals(e,o){return ensureString(e)==ensureString(o)}function stringEqualsIgnore(e,o){return ensureString(e).toLowerCase()==ensureString(o).toLowerCase()}function ensureString(e){if(null!=e)try{return String(e)}catch(e){console.warn("ensureString() caught error:",e)}return""}function isEmpty(e){return void 0===e||(!e||("string"==typeof e&&""==e.trim()||("object"==typeof e&&void 0!==e.length&&e.length<1||"object"==typeof e&&0===Object.keys(e).length&&e.constructor===Object)))}function setSessionValue(o,t){if(void 0===t)t="";"undefined"==t&&console.log('getSessionValue() STRING = "UNDEFINED"'),void 0===t&&console.log("getSessionValue() IS UNDEFINED");try{sessionStorage.setItem(o,t)}catch(e){console.warn("setSessionValue(): Unable to use session storage."),createCookie(o,t,0)}}function getSessionValue(o){var t=null;try{t=sessionStorage.getItem(o)}catch(e){console.warn("getSessionValue(): Unable to use session storage."),t=readCookie(o)}return t}function removeSessionValue(o){try{value=sessionStorage.removeItem(o)}catch(e){console.warn("removeLocalValue(): Unable to use session storage."),createCookie(o,"",-1)}return value}function setLocalValue(o,t){if(void 0===t)t="";"undefined"==t&&console.log('getSessionValue() STRING = "UNDEFINED"'),void 0===t&&console.log("getSessionValue() IS UNDEFINED");try{localStorage.setItem(o,t)}catch(e){console.warn("setLocalValue(): Unable to use local storage."),createCookie(o,t,365)}}function getLocalValue(o){var t=null;try{t=localStorage.getItem(o)}catch(e){console.warn("getLocalValue(): Unable to use local storage."),t=readCookie(o)}return t}function removeLocalValue(o){try{value=localStorage.removeItem(o)}catch(e){console.warn("removeLocalValue(): Unable to use local storage."),createCookie(o,"",-1)}return value}function createCookie(e,o,t){var n="";if(t){var s=new Date;s.setTime(s.getTime()+24*t*60*60*1e3),n="; expires="+s.toGMTString()}document.cookie=e+"="+o+n+"; path=/"}function readCookie(e){for(var o=e+"=",t=document.cookie.split(";"),n=0;n<t.length;n++){for(var s=t[n];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(o))return s.substring(o.length,s.length)}return!1}function getUrlParameter(e,o){if(void 0===o)o=!0;var t=ensureString(e);if(isEmpty(t))return console.warn("getUrlParameter() given empty input"),"";"object"!=typeof window.mwdspace.urlParameters&&makeUrlParameterList();var n=new RegExp(t,o?"i":"");for(parameterKey in window.mwdspace.urlParameters)if(parameterKey.match(n))return window.mwdspace.urlParameters[parameterKey];return""}function makeUrlParameterList(){window.mwdspace.urlParameters={};for(var e,o,t=window.location.search.split(/[\?&]/),n=0;n<t.length;n++)isEmpty(t[n])||(o=(o=ensureString((e=t[n].split("="))[0])).replace("+"," "),isEmpty(o=decodeURIComponent(o))||isEmpty(o)||(window.mwdspace.urlParameters[o]=decodeURIComponent(e[1])))}console.log("shared-utils.js v18.4.19"),window.mwdspace=window.mwdspace||{},console.log("business-logic-layer.js v18.4.19"),console.log("transaction-system-layer.js v18.4.19");var donationStartTime,apiConstants={baseUrl:"localhost:8080/funraise/public/v2/"},requestTimeoutSeconds=20;function startDonation(e,t,n){if(console.log(">>>> startDonation()"),console.log(),void 0===e)e={};sendXhrRequest({method:"post",url:apiConstants+"donation"},function(e){if(!e.jsonData||!e.jsonData.id)return console.error('startDonation(): Invalid response, no "id". Response from',url,"follows:"),n(e);var o=e.jsonData.id;donationStartTime=new Date,setSessionValue("donationInProgress",o),setSessionValue("donationStartTime",donationStartTime.toUTCString()),completeDonation(o,100,t,n)},n)}function completeDonation(o,t,n,s){console.log(">>>> completeDonation()",o,t);var e=(new Date).getTime()-donationStartTime.getTime();if(console.log("elapsedMilliseconds",e),1e3*requestTimeoutSeconds<e)return console.error("completeDonation(): request timeout reached, calling fail function."),s({});console.log("completeDonation() WAITING..."),setTimeout(function(){console.log("completeDonation() RUNNING"),sendXhrRequest({method:"get",url:apiConstants+"donation/"+o},function(e){return 204==e.status?(console.log("STATUS 204 RECEIVED, DONATION STILL PROCESSING"),completeDonation(o,t*=1.5)):e.jsonData?(removeSessionValue("donationInProgress"),removeSessionValue("donationStartTime"),void n(e)):(console.error('completeDonation(): Invalid response, no "id". Response from',url,"follows:"),s(e))},s)},t)}function sendXhrRequest(e,t,o){if(void 0===e)e={};var n=e.method||"post",s=e.url||"",r=!0===e.verbose,a=getContentType(e.sendContentType||null),i=getContentType(e.acceptContentType||null),l="function"==typeof e.progressFunction&&e.progressFunction,c=new XMLHttpRequest;c.setRequestHeader("Content-Type",a),c.setRequestHeader("Accept",i),c.addEventListener("load",function(){if(200<=this.status&&this.status<=299){r&&console.log(this.responseText);var e=safeJsonParse(this.responseText);if(e&&!isEmpty(e.messages))for(var o=0;o<e.messages.length;o++)showUserMessage("Server says - "+e.messages[o]);e?t(e):(console.error("INVALID RESPONSE FROM SERVER. RESPONSE FOLLOWS:"),console.log(this.responseText),showUserMessage("There appears to be a problem on the server.",{isError:!0}),t({}))}else console.log(">>> sendXhrRequest() raw response",this.responseText),showUserMessage("The server has reported an issue.",{isError:!0}),t({})}),c.addEventListener("error",function(){console.warn("sendXhrRequest(): request canceled"),o(this)}),c.addEventListener("abort",requestCanceled),l&&c.addEventListener("progress",function(e){e.percentComplete=e.lengthComputable?e.loaded/e.total*100:null,l(e)});e.urlArgString;r&&console.log(">>> sendXhrRequest() sending to",s),c.open(n,s,!0),c.send()}function getContentType(e){switch(e=ensureString(e).toLowerCase()){case"url":case"urlencoded":return"application/x-www-form-urlencoded";case"text":return"text/plain";default:return"application/json; charset=utf-8"}}console.log("user-interface-layer.js v18.4.19");var stepList=document.querySelectorAll("section.step"),domMainBackButton=document.querySelector("button.goPreviousStep");function showStep(o){var t;stepList.forEach(function(e){(t=e.getAttribute("data-step-name"))==o?("giftAmount"==t?$(domMainBackButton).hide():$(domMainBackButton).show(),$(e).fadeIn(666)):$(e).hide()})}showStep("giftAmount"),$("input[type=radio]").change(function(){$("div.giftFormHeaderContainer").slideDown(666)}),document.addEventListener("click",function(e){console.log("CLICK ON",e.target.tagName,e.target.className);var o=$(e.target).closest("button, .clickTarget");if(console.log("RESOLVED TO",o.prop("tagName"),o.attr("class")),console.log("typeof clickTarget",typeof o),o)if(o.hasClass("processDonation")){var t=e.target.getAttribute("data-working");t&&(e.target.classList.add("blocked"),e.target.innerHTML=t)}else o.hasClass("goNextStep")&&showStep("payment")});