console.log("transaction-system-layer.js v18.4.19"),window.mwdspace=window.mwdspace||{};var apiConstants={baseUrl:"http://localhost:8080/funraise/public/api/v2/",organizationId:"1e78fec4-8fd0-4a3e-b82b-866c29012531"},requestTimeoutSeconds=20,requestInitialPollDelay=1e3;window.mwdspace=window.mwdspace||{},window.mwdspace.donationInProgress=!1,window.mwdspace.donationStartTime,window.mwdspace.currencyList=[{code:"USD",name:"U.S. Dollar",symbol:"$"},{code:"CAD",name:"Canadian Dollar",symbol:"C$"},{code:"MXN",name:"Mexican Peso",symbol:"MEX"},{code:"BRL",name:"Brazilian Real",symbol:"R$"},{code:"INR",name:"Indian Rupee",symbol:"&#8360;"}],window.mwdspace.payMethodList=[{code:"card",name:"Card",description:"Donate With Card",minimumAmount:5,maximumAmount:2e4,subtypes:[{code:"card",name:"Donate With Card"}],frequencies:[{code:"single",name:"One-Time"},{code:"monthly",name:"Monthly"}]},{code:"bitcoin",name:"Bitcoin",description:"Donate With Bitcoin",minimumAmount:5,maximumAmount:2e4,frequencies:[{code:"single",name:"One-Time"}]}];function startDonation(a,b,c){if(console.log(">>>> startDonation()"),"undefined"==typeof a)var a={};window.mwdspace.donationInProgress=!0;var d=a.data||{};d.organizationId=apiConstants.organizationId,d.sourceUrl=d.sourceUrl||window.location.hostname+window.location.pathname,d.referrer=d.referrer||document.referrer||"";var e={method:"post",url:apiConstants.baseUrl+"donation",sendData:d,verbose:!0};try{sendXhrRequest(e,function(a){if(console.log("response INITIAL",typeof a,a),!a.json||!a.json.id)return console.error("startDonation(): Invalid response, no \"id\":"),console.log(a),c(a);var d=a.json.id;window.mwdspace.donationStartTime=new Date,setSessionValue("donationId",d),setSessionValue("donationStartTime",window.mwdspace.donationStartTime.toUTCString()),completeDonation(d,requestInitialPollDelay,b,c)},c)}catch(a){console.error("startDonation CAUGHT ERROR",a),c({})}}function completeDonation(a,b,c,d){if("undefined"==typeof a)var a="";if("undefined"==typeof b)var b=0;a||(console.error("completeDonation(): Empty id given"),d({})),0>=b&&(b=1e3),console.log(">>>> completeDonation() (",typeof a,")",a,b);var e=new Date().getTime()-window.mwdspace.donationStartTime.getTime();return console.log("elapsedMilliseconds",e),e>1e3*requestTimeoutSeconds?(console.error("completeDonation(): request timeout reached, calling fail function."),d({})):void setTimeout(function(){console.log("completeDonation() RUNNING");var e=apiConstants.baseUrl+"donation/"+a;sendXhrRequest({method:"get",url:e,verbose:!0},function(e){return(console.log("response POLL",typeof e,e),204==e.status)?(console.log("STATUS 204 RECEIVED, DONATION STILL PROCESSING"),completeDonation(a,b*=1.25,c,d)):e.json?(removeSessionValue("donationId"),removeSessionValue("donationStartTime"),c(e)):(console.error("completeDonation(): Invalid response follows:"),console.warn(e),d(e))},d)},b)}function sendXhrRequest(a,b,c){if("undefined"==typeof a)var a={};var d=a.method||"post",e=a.url||"",f=getContentType(a.sendContentType||null),g=getContentType(a.acceptContentType||null),h=!("function"!=typeof a.progressFunction)&&a.progressFunction,i=!(!0!==a.verbose),j=a.sendData||{};j&&"string"!=typeof j&&(j=safeJsonString(j));var k=new XMLHttpRequest;k.addEventListener("load",function(){if(200<=this.status&&299>=this.status){var a={status:this.status,text:this.responseText,json:{}};this.responseText&&(a.json=safeJsonParse(this.responseText)||{}),a.json||204==this.status?b(a):(console.error("INVALID RESPONSE FROM SERVER. RESPONSE FOLLOWS:"),console.log(this.responseText),console.warn("There may be a problem on the server.",{isError:!0}),b({}))}else console.log(">>> sendXhrRequest() raw response",this.responseText),console.warn("The server has reported an issue.",{isError:!0}),b({})}),k.addEventListener("error",function(a){console.log("event.status",a.status),console.warn("sendXhrRequest(): request failed",this),console.log(a),c(this)}),k.addEventListener("abort",function(a){console.warn("sendXhrRequest(): request canceled",this),console.log(a),c(this)}),h&&k.addEventListener("progress",function(a){a.percentComplete=a.lengthComputable?100*(a.loaded/a.total):null,h(a)}),i&&console.log(">>> sendXhrRequest() sending to",e),k.open(d,e,!0),k.setRequestHeader("Content-Type",f),k.setRequestHeader("Accept",g),k.send(j),i&&console.log(">>> sendXhrRequest() sent with data",j)}function getContentType(a){switch(a=ensureString(a).toLowerCase(),a){case"url":case"urlencoded":return"application/x-www-form-urlencoded";break;case"text":return"text/plain";break;default:return"application/json";}}